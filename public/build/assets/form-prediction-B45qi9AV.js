var Cs=Object.defineProperty;var Ce=a=>{throw TypeError(a)};var qs=(a,i,c)=>i in a?Cs(a,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[i]=c;var qe=(a,i,c)=>qs(a,typeof i!="symbol"?i+"":i,c),he=(a,i,c)=>i.has(a)||Ce("Cannot "+c);var pt=(a,i,c)=>(he(a,i,"read from private field"),c?c.call(a):i.get(a)),ue=(a,i,c)=>i.has(a)?Ce("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(a):i.set(a,c),Zt=(a,i,c,d)=>(he(a,i,"write to private field"),d?d.call(a,c):i.set(a,c),c),fe=(a,i,c)=>(he(a,i,"access private method"),c);import{g as Ue,a as _e,b as Ut,K as Os,r as At,m as Ds,j as V}from"./app-BdSiAjyP.js";import{c as $s,B as Vs}from"./leaf-DbhNcTOD.js";import{L as Ht,I as Ls,a as Bs}from"./input-error-Chbo7qiN.js";import{S as ae,a as ce,b as me,c as ge,d as we}from"./select-DcjTyB4S.js";import{T as Ps}from"./toast-CmT7txdK.js";const zs=Object.prototype.toString;function qt(a){const i=zs.call(a);return i.endsWith("Array]")&&!i.includes("Big")}const Us=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:qt},Symbol.toStringTag,{value:"Module"}));var X={};const _s=Ue(Us);function Xs(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");var c=i.fromIndex,d=c===void 0?0:c,M=i.toIndex,E=M===void 0?a.length:M;if(d<0||d>=a.length||!Number.isInteger(d))throw new Error("fromIndex must be a positive integer smaller than length");if(E<=d||E>a.length||!Number.isInteger(E))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var k=a[d],T=d+1;T<E;T++)a[T]>k&&(k=a[T]);return k}function Ws(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!qt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");var c=i.fromIndex,d=c===void 0?0:c,M=i.toIndex,E=M===void 0?a.length:M;if(d<0||d>=a.length||!Number.isInteger(d))throw new Error("fromIndex must be a positive integer smaller than length");if(E<=d||E>a.length||!Number.isInteger(E))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var k=a[d],T=d+1;T<E;T++)a[T]<k&&(k=a[T]);return k}function Js(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(qt(a)){if(a.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var c;if(i.output!==void 0){if(!qt(i.output))throw new TypeError("output option must be an array if specified");c=i.output}else c=new Array(a.length);var d=Ws(a),M=Xs(a);if(d===M)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var E=i.min,k=E===void 0?i.autoMinMax?d:0:E,T=i.max,v=T===void 0?i.autoMinMax?M:1:T;if(k>=v)throw new RangeError("min option must be smaller than max option");for(var O=(v-k)/(M-d),_=0;_<a.length;_++)c[_]=(a[_]-d)*O+k;return c}const Ys=Object.freeze(Object.defineProperty({__proto__:null,default:Js},Symbol.toStringTag,{value:"Module"})),Qs=Ue(Ys);var Oe;function Gs(){var zt,Me,it;if(Oe)return X;Oe=1,Object.defineProperty(X,"__esModule",{value:!0});var a=_s,i=Qs;const c=" ".repeat(2),d=" ".repeat(4);function M(){return E(this)}function E(o,r={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:s=8,padMinus:n="auto"}=r;return`${o.constructor.name} {
${c}[
${d}${k(o,e,t,s,n)}
${c}]
${c}rows: ${o.rows}
${c}columns: ${o.columns}
}`}function k(o,r,e,t,s){const{rows:n,columns:l}=o,h=Math.min(n,r),u=Math.min(l,e),f=[];if(s==="auto"){s=!1;t:for(let p=0;p<h;p++)for(let m=0;m<u;m++)if(o.get(p,m)<0){s=!0;break t}}for(let p=0;p<h;p++){let m=[];for(let b=0;b<u;b++)m.push(T(o.get(p,b),t,s));f.push(`${m.join(" ")}`)}return u!==l&&(f[f.length-1]+=` ... ${l-e} more columns`),h!==n&&f.push(`... ${n-r} more rows`),f.join(`
${d}`)}function T(o,r,e){return(o>=0&&e?` ${v(o,r-1)}`:v(o,r)).padEnd(r)}function v(o,r){let e=o.toString();if(e.length<=r)return e;let t=o.toFixed(r);if(t.length>r&&(t=o.toFixed(Math.max(0,r-(t.length-r)))),t.length<=r&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let s=o.toExponential(r);return s.length>r&&(s=o.toExponential(Math.max(0,r-(s.length-r)))),s.slice(0)}function O(o,r){o.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},o.prototype.addS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)+t);return this},o.prototype.addM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)+t.get(s,n));return this},o.add=function(t,s){return new r(t).add(s)},o.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},o.prototype.subS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)-t);return this},o.prototype.subM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)-t.get(s,n));return this},o.sub=function(t,s){return new r(t).sub(s)},o.prototype.subtract=o.prototype.sub,o.prototype.subtractS=o.prototype.subS,o.prototype.subtractM=o.prototype.subM,o.subtract=o.sub,o.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},o.prototype.mulS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)*t);return this},o.prototype.mulM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)*t.get(s,n));return this},o.mul=function(t,s){return new r(t).mul(s)},o.prototype.multiply=o.prototype.mul,o.prototype.multiplyS=o.prototype.mulS,o.prototype.multiplyM=o.prototype.mulM,o.multiply=o.mul,o.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},o.prototype.divS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)/t);return this},o.prototype.divM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)/t.get(s,n));return this},o.div=function(t,s){return new r(t).div(s)},o.prototype.divide=o.prototype.div,o.prototype.divideS=o.prototype.divS,o.prototype.divideM=o.prototype.divM,o.divide=o.div,o.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},o.prototype.modS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)%t);return this},o.prototype.modM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)%t.get(s,n));return this},o.mod=function(t,s){return new r(t).mod(s)},o.prototype.modulus=o.prototype.mod,o.prototype.modulusS=o.prototype.modS,o.prototype.modulusM=o.prototype.modM,o.modulus=o.mod,o.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},o.prototype.andS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)&t);return this},o.prototype.andM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)&t.get(s,n));return this},o.and=function(t,s){return new r(t).and(s)},o.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},o.prototype.orS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)|t);return this},o.prototype.orM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)|t.get(s,n));return this},o.or=function(t,s){return new r(t).or(s)},o.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},o.prototype.xorS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)^t);return this},o.prototype.xorM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)^t.get(s,n));return this},o.xor=function(t,s){return new r(t).xor(s)},o.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},o.prototype.leftShiftS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)<<t);return this},o.prototype.leftShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)<<t.get(s,n));return this},o.leftShift=function(t,s){return new r(t).leftShift(s)},o.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},o.prototype.signPropagatingRightShiftS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>t);return this},o.prototype.signPropagatingRightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>t.get(s,n));return this},o.signPropagatingRightShift=function(t,s){return new r(t).signPropagatingRightShift(s)},o.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},o.prototype.rightShiftS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>>t);return this},o.prototype.rightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)>>>t.get(s,n));return this},o.rightShift=function(t,s){return new r(t).rightShift(s)},o.prototype.zeroFillRightShift=o.prototype.rightShift,o.prototype.zeroFillRightShiftS=o.prototype.rightShiftS,o.prototype.zeroFillRightShiftM=o.prototype.rightShiftM,o.zeroFillRightShift=o.rightShift,o.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,~this.get(t,s));return this},o.not=function(t){return new r(t).not()},o.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.abs(this.get(t,s)));return this},o.abs=function(t){return new r(t).abs()},o.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.acos(this.get(t,s)));return this},o.acos=function(t){return new r(t).acos()},o.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.acosh(this.get(t,s)));return this},o.acosh=function(t){return new r(t).acosh()},o.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.asin(this.get(t,s)));return this},o.asin=function(t){return new r(t).asin()},o.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.asinh(this.get(t,s)));return this},o.asinh=function(t){return new r(t).asinh()},o.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.atan(this.get(t,s)));return this},o.atan=function(t){return new r(t).atan()},o.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.atanh(this.get(t,s)));return this},o.atanh=function(t){return new r(t).atanh()},o.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cbrt(this.get(t,s)));return this},o.cbrt=function(t){return new r(t).cbrt()},o.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.ceil(this.get(t,s)));return this},o.ceil=function(t){return new r(t).ceil()},o.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.clz32(this.get(t,s)));return this},o.clz32=function(t){return new r(t).clz32()},o.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cos(this.get(t,s)));return this},o.cos=function(t){return new r(t).cos()},o.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.cosh(this.get(t,s)));return this},o.cosh=function(t){return new r(t).cosh()},o.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.exp(this.get(t,s)));return this},o.exp=function(t){return new r(t).exp()},o.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.expm1(this.get(t,s)));return this},o.expm1=function(t){return new r(t).expm1()},o.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.floor(this.get(t,s)));return this},o.floor=function(t){return new r(t).floor()},o.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.fround(this.get(t,s)));return this},o.fround=function(t){return new r(t).fround()},o.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log(this.get(t,s)));return this},o.log=function(t){return new r(t).log()},o.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log1p(this.get(t,s)));return this},o.log1p=function(t){return new r(t).log1p()},o.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log10(this.get(t,s)));return this},o.log10=function(t){return new r(t).log10()},o.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.log2(this.get(t,s)));return this},o.log2=function(t){return new r(t).log2()},o.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.round(this.get(t,s)));return this},o.round=function(t){return new r(t).round()},o.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sign(this.get(t,s)));return this},o.sign=function(t){return new r(t).sign()},o.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sin(this.get(t,s)));return this},o.sin=function(t){return new r(t).sin()},o.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sinh(this.get(t,s)));return this},o.sinh=function(t){return new r(t).sinh()},o.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.sqrt(this.get(t,s)));return this},o.sqrt=function(t){return new r(t).sqrt()},o.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.tan(this.get(t,s)));return this},o.tan=function(t){return new r(t).tan()},o.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.tanh(this.get(t,s)));return this},o.tanh=function(t){return new r(t).tanh()},o.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.set(t,s,Math.trunc(this.get(t,s)));return this},o.trunc=function(t){return new r(t).trunc()},o.pow=function(t,s){return new r(t).pow(s)},o.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},o.prototype.powS=function(t){for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)**t);return this},o.prototype.powM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let n=0;n<this.columns;n++)this.set(s,n,this.get(s,n)**t.get(s,n));return this}}function _(o,r,e){let t=e?o.rows:o.rows-1;if(r<0||r>t)throw new RangeError("Row index out of range")}function U(o,r,e){let t=e?o.columns:o.columns-1;if(r<0||r>t)throw new RangeError("Column index out of range")}function tt(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function gt(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function ct(o,r){if(!a.isAnyArray(r))throw new TypeError("row indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.rows)throw new RangeError("row indices are out of range")}function Bt(o,r){if(!a.isAnyArray(r))throw new TypeError("column indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.columns)throw new RangeError("column indices are out of range")}function Pt(o,r,e,t,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if($t("startRow",r),$t("endRow",e),$t("startColumn",t),$t("endColumn",s),r>e||t>s||r<0||r>=o.rows||e<0||e>=o.rows||t<0||t>=o.columns||s<0||s>=o.columns)throw new RangeError("Submatrix indices are out of range")}function Dt(o,r=0){let e=[];for(let t=0;t<o;t++)e.push(r);return e}function $t(o,r){if(typeof r!="number")throw new TypeError(`${o} must be a number`)}function yt(o){if(o.isEmpty())throw new Error("Empty matrix has no elements to index")}function ne(o){let r=Dt(o.rows);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]+=o.get(e,t);return r}function oe(o){let r=Dt(o.columns);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]+=o.get(e,t);return r}function ie(o){let r=0;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r+=o.get(e,t);return r}function J(o){let r=Dt(o.rows,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]*=o.get(e,t);return r}function P(o){let r=Dt(o.columns,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]*=o.get(e,t);return r}function K(o){let r=1;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r*=o.get(e,t);return r}function ht(o,r,e){const t=o.rows,s=o.columns,n=[];for(let l=0;l<t;l++){let h=0,u=0,f=0;for(let p=0;p<s;p++)f=o.get(l,p)-e[l],h+=f,u+=f*f;r?n.push((u-h*h/s)/(s-1)):n.push((u-h*h/s)/s)}return n}function jt(o,r,e){const t=o.rows,s=o.columns,n=[];for(let l=0;l<s;l++){let h=0,u=0,f=0;for(let p=0;p<t;p++)f=o.get(p,l)-e[l],h+=f,u+=f*f;r?n.push((u-h*h/t)/(t-1)):n.push((u-h*h/t)/t)}return n}function et(o,r,e){const t=o.rows,s=o.columns,n=t*s;let l=0,h=0,u=0;for(let f=0;f<t;f++)for(let p=0;p<s;p++)u=o.get(f,p)-e,l+=u,h+=u*u;return r?(h-l*l/n)/(n-1):(h-l*l/n)/n}function mt(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[e])}function Tt(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[t])}function Ge(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r)}function Ke(o){const r=[];for(let e=0;e<o.rows;e++){let t=0;for(let s=0;s<o.columns;s++)t+=o.get(e,s)**2/(o.columns-1);r.push(Math.sqrt(t))}return r}function Ze(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[e])}function Ae(o){const r=[];for(let e=0;e<o.columns;e++){let t=0;for(let s=0;s<o.rows;s++)t+=o.get(s,e)**2/(o.rows-1);r.push(Math.sqrt(t))}return r}function He(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[t])}function ts(o){const r=o.size-1;let e=0;for(let t=0;t<o.columns;t++)for(let s=0;s<o.rows;s++)e+=o.get(s,t)**2/r;return Math.sqrt(e)}function es(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r)}class z{static from1DArray(r,e,t){if(r*e!==t.length)throw new RangeError("data length does not match given dimensions");let n=new I(r,e);for(let l=0;l<r;l++)for(let h=0;h<e;h++)n.set(l,h,t[l*e+h]);return n}static rowVector(r){let e=new I(1,r.length);for(let t=0;t<r.length;t++)e.set(0,t,r[t]);return e}static columnVector(r){let e=new I(r.length,1);for(let t=0;t<r.length;t++)e.set(t,0,r[t]);return e}static zeros(r,e){return new I(r,e)}static ones(r,e){return new I(r,e).fill(1)}static rand(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=t;let n=new I(r,e);for(let l=0;l<r;l++)for(let h=0;h<e;h++)n.set(l,h,s());return n}static randInt(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:s=0,max:n=1e3,random:l=Math.random}=t;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(s>=n)throw new RangeError("min must be smaller than max");let h=n-s,u=new I(r,e);for(let f=0;f<r;f++)for(let p=0;p<e;p++){let m=s+Math.round(l()*h);u.set(f,p,m)}return u}static eye(r,e,t){e===void 0&&(e=r),t===void 0&&(t=1);let s=Math.min(r,e),n=this.zeros(r,e);for(let l=0;l<s;l++)n.set(l,l,t);return n}static diag(r,e,t){let s=r.length;e===void 0&&(e=s),t===void 0&&(t=e);let n=Math.min(s,e,t),l=this.zeros(e,t);for(let h=0;h<n;h++)l.set(h,h,r[h]);return l}static min(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,s=r.columns,n=new I(t,s);for(let l=0;l<t;l++)for(let h=0;h<s;h++)n.set(l,h,Math.min(r.get(l,h),e.get(l,h)));return n}static max(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,s=r.columns,n=new this(t,s);for(let l=0;l<t;l++)for(let h=0;h<s;h++)n.set(l,h,Math.max(r.get(l,h),e.get(l,h)));return n}static checkMatrix(r){return z.isMatrix(r)?r:new I(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.call(this,e,t);return this}to1DArray(){let r=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}to2DArray(){let r=[];for(let e=0;e<this.rows;e++){r.push([]);for(let t=0;t<this.columns;t++)r[e].push(this.get(e,t))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let e=0;e<=r;e++)if(this.get(r,e)!==this.get(e,r))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let r=0;r<this.rows;r++)if(this.get(r,r)!==0)return!1;return!0}isEchelonForm(){let r=0,e=0,t=-1,s=!0,n=!1;for(;r<this.rows&&s;){for(e=0,n=!1;e<this.columns&&n===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(n=!0,t=e):(s=!1,n=!0);r++}return s}isReducedEchelonForm(){let r=0,e=0,t=-1,s=!0,n=!1;for(;r<this.rows&&s;){for(e=0,n=!1;e<this.columns&&n===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(n=!0,t=e):(s=!1,n=!0);for(let l=e+1;l<this.rows;l++)this.get(r,l)!==0&&(s=!1);r++}return s}echelonForm(){let r=this.clone(),e=0,t=0;for(;e<r.rows&&t<r.columns;){let s=e;for(let n=e;n<r.rows;n++)r.get(n,t)>r.get(s,t)&&(s=n);if(r.get(s,t)===0)t++;else{r.swapRows(e,s);let n=r.get(e,t);for(let l=t;l<r.columns;l++)r.set(e,l,r.get(e,l)/n);for(let l=e+1;l<r.rows;l++){let h=r.get(l,t)/r.get(e,t);r.set(l,t,0);for(let u=t+1;u<r.columns;u++)r.set(l,u,r.get(l,u)-r.get(e,u)*h)}e++,t++}}return r}reducedEchelonForm(){let r=this.echelonForm(),e=r.columns,t=r.rows,s=t-1;for(;s>=0;)if(r.maxRow(s)===0)s--;else{let n=0,l=!1;for(;n<t&&l===!1;)r.get(s,n)===1?l=!0:n++;for(let h=0;h<s;h++){let u=r.get(h,n);for(let f=n;f<e;f++){let p=r.get(h,f)-u*r.get(s,f);r.set(h,f,p)}}s--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=r;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let s=new I(this.rows*e,this.columns*t);for(let n=0;n<e;n++)for(let l=0;l<t;l++)s.setSubMatrix(this,this.rows*n,this.columns*l);return s}fill(r){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,r);return this}neg(){return this.mulS(-1)}getRow(r){_(this,r);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}getRowVector(r){return I.rowVector(this.getRow(r))}setRow(r,e){_(this,r),e=tt(this,e);for(let t=0;t<this.columns;t++)this.set(r,t,e[t]);return this}swapRows(r,e){_(this,r),_(this,e);for(let t=0;t<this.columns;t++){let s=this.get(r,t);this.set(r,t,this.get(e,t)),this.set(e,t,s)}return this}getColumn(r){U(this,r);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,r));return e}getColumnVector(r){return I.columnVector(this.getColumn(r))}setColumn(r,e){U(this,r),e=gt(this,e);for(let t=0;t<this.rows;t++)this.set(t,r,e[t]);return this}swapColumns(r,e){U(this,r),U(this,e);for(let t=0;t<this.rows;t++){let s=this.get(t,r);this.set(t,r,this.get(t,e)),this.set(t,e,s)}return this}addRowVector(r){r=tt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[t]);return this}subRowVector(r){r=tt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[t]);return this}mulRowVector(r){r=tt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[t]);return this}divRowVector(r){r=tt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[t]);return this}addColumnVector(r){r=gt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[e]);return this}subColumnVector(r){r=gt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[e]);return this}mulColumnVector(r){r=gt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[e]);return this}divColumnVector(r){r=gt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[e]);return this}mulRow(r,e){_(this,r);for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e);return this}mulColumn(r,e){U(this,r);for(let t=0;t<this.rows;t++)this.set(t,r,this.get(t,r)*e);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e[t]&&(e[t]=this.get(t,s));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e[s]&&(e[s]=this.get(t,s));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s));return e}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){yt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)>r&&(r=this.get(t,s),e[0]=t,e[1]=s);return e}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e[t]&&(e[t]=this.get(t,s));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e[s]&&(e[s]=this.get(t,s));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s));return e}default:throw new Error(`invalid option: ${r}`)}}minIndex(){yt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let s=0;s<this.columns;s++)this.get(t,s)<r&&(r=this.get(t,s),e[0]=t,e[1]=s);return e}maxRow(r){if(_(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxRowIndex(r){_(this,r),yt(this);let e=this.get(r,0),t=[r,0];for(let s=1;s<this.columns;s++)this.get(r,s)>e&&(e=this.get(r,s),t[1]=s);return t}minRow(r){if(_(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minRowIndex(r){_(this,r),yt(this);let e=this.get(r,0),t=[r,0];for(let s=1;s<this.columns;s++)this.get(r,s)<e&&(e=this.get(r,s),t[1]=s);return t}maxColumn(r){if(U(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxColumnIndex(r){U(this,r),yt(this);let e=this.get(0,r),t=[0,r];for(let s=1;s<this.rows;s++)this.get(s,r)>e&&(e=this.get(s,r),t[0]=s);return t}minColumn(r){if(U(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)<e&&(e=this.get(t,r));return e}minColumnIndex(r){U(this,r),yt(this);let e=this.get(0,r),t=[0,r];for(let s=1;s<this.rows;s++)this.get(s,r)<e&&(e=this.get(s,r),t[0]=s);return t}diag(){let r=Math.min(this.rows,this.columns),e=[];for(let t=0;t<r;t++)e.push(this.get(t,t));return e}norm(r="frobenius"){switch(r){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${r}`)}}cumulativeSum(){let r=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r+=this.get(e,t),this.set(e,t,r);return this}dot(r){z.isMatrix(r)&&(r=r.to1DArray());let e=this.to1DArray();if(e.length!==r.length)throw new RangeError("vectors do not have the same size");let t=0;for(let s=0;s<e.length;s++)t+=e[s]*r[s];return t}mmul(r){r=I.checkMatrix(r);let e=this.rows,t=this.columns,s=r.columns,n=new I(e,s),l=new Float64Array(t);for(let h=0;h<s;h++){for(let u=0;u<t;u++)l[u]=r.get(u,h);for(let u=0;u<e;u++){let f=0;for(let p=0;p<t;p++)f+=this.get(u,p)*l[p];n.set(u,h,f)}}return n}mpow(r){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(r)||r<0)throw new RangeError("Exponent must be a non-negative integer");let e=I.eye(this.rows),t=this;for(let s=r;s>=1;s/=2)(s&1)!==0&&(e=e.mmul(t)),t=t.mmul(t);return e}strassen2x2(r){r=I.checkMatrix(r);let e=new I(2,2);const t=this.get(0,0),s=r.get(0,0),n=this.get(0,1),l=r.get(0,1),h=this.get(1,0),u=r.get(1,0),f=this.get(1,1),p=r.get(1,1),m=(t+f)*(s+p),b=(h+f)*s,N=t*(l-p),y=f*(u-s),j=(t+n)*p,F=(h-t)*(s+l),g=(n-f)*(u+p),R=m+y-j+g,q=N+j,L=b+y,B=m-b+N+F;return e.set(0,0,R),e.set(0,1,q),e.set(1,0,L),e.set(1,1,B),e}strassen3x3(r){r=I.checkMatrix(r);let e=new I(3,3);const t=this.get(0,0),s=this.get(0,1),n=this.get(0,2),l=this.get(1,0),h=this.get(1,1),u=this.get(1,2),f=this.get(2,0),p=this.get(2,1),m=this.get(2,2),b=r.get(0,0),N=r.get(0,1),y=r.get(0,2),j=r.get(1,0),F=r.get(1,1),g=r.get(1,2),R=r.get(2,0),q=r.get(2,1),L=r.get(2,2),B=(t+s+n-l-h-p-m)*F,Z=(t-l)*(-N+F),D=h*(-b+N+j-F-g-R+L),$=(-t+l+h)*(b-N+F),Q=(l+h)*(-b+N),w=t*b,S=(-t+f+p)*(b-y+g),C=(-t+f)*(y-g),x=(f+p)*(-b+y),A=(t+s+n-h-u-f-p)*g,Y=p*(-b+y+j-F-g-R+q),G=(-n+p+m)*(F+R-q),H=(n-m)*(F-q),nt=n*R,wt=(p+m)*(-R+q),st=(-n+h+u)*(g+R-L),bt=(n-u)*(g-L),xt=(h+u)*(-R+L),W=s*j,ot=u*q,ft=l*y,at=f*N,rt=m*L,Ss=w+nt+W,xs=B+$+Q+w+G+nt+wt,ks=w+S+x+A+nt+st+xt,Rs=Z+D+$+w+nt+st+bt,Ns=Z+$+Q+w+ot,vs=nt+st+bt+xt+ft,Is=w+S+C+Y+G+H+nt,Ts=G+H+nt+wt+at,Fs=w+S+C+x+rt;return e.set(0,0,Ss),e.set(0,1,xs),e.set(0,2,ks),e.set(1,0,Rs),e.set(1,1,Ns),e.set(1,2,vs),e.set(2,0,Is),e.set(2,1,Ts),e.set(2,2,Fs),e}mmulStrassen(r){r=I.checkMatrix(r);let e=this.clone(),t=e.rows,s=e.columns,n=r.rows,l=r.columns;s!==n&&console.warn(`Multiplying ${t} x ${s} and ${n} x ${l} matrix: dimensions do not match.`);function h(m,b,N){let y=m.rows,j=m.columns;if(y===b&&j===N)return m;{let F=z.zeros(b,N);return F=F.setSubMatrix(m,0,0),F}}let u=Math.max(t,n),f=Math.max(s,l);e=h(e,u,f),r=h(r,u,f);function p(m,b,N,y){if(N<=512||y<=512)return m.mmul(b);N%2===1&&y%2===1?(m=h(m,N+1,y+1),b=h(b,N+1,y+1)):N%2===1?(m=h(m,N+1,y),b=h(b,N+1,y)):y%2===1&&(m=h(m,N,y+1),b=h(b,N,y+1));let j=parseInt(m.rows/2,10),F=parseInt(m.columns/2,10),g=m.subMatrix(0,j-1,0,F-1),R=b.subMatrix(0,j-1,0,F-1),q=m.subMatrix(0,j-1,F,m.columns-1),L=b.subMatrix(0,j-1,F,b.columns-1),B=m.subMatrix(j,m.rows-1,0,F-1),Z=b.subMatrix(j,b.rows-1,0,F-1),D=m.subMatrix(j,m.rows-1,F,m.columns-1),$=b.subMatrix(j,b.rows-1,F,b.columns-1),Q=p(z.add(g,D),z.add(R,$),j,F),w=p(z.add(B,D),R,j,F),S=p(g,z.sub(L,$),j,F),C=p(D,z.sub(Z,R),j,F),x=p(z.add(g,q),$,j,F),A=p(z.sub(B,g),z.add(R,L),j,F),Y=p(z.sub(q,D),z.add(Z,$),j,F),G=z.add(Q,C);G.sub(x),G.add(Y);let H=z.add(S,x),nt=z.add(w,C),wt=z.sub(Q,w);wt.add(S),wt.add(A);let st=z.zeros(2*G.rows,2*G.columns);return st=st.setSubMatrix(G,0,0),st=st.setSubMatrix(H,G.rows,0),st=st.setSubMatrix(nt,0,G.columns),st=st.setSubMatrix(wt,G.rows,G.columns),st.subMatrix(0,N-1,0,y-1)}return p(e,r,u,f)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let s=new I(this.rows,this.columns);for(let n=0;n<this.rows;n++){const l=this.getRow(n);l.length>0&&i(l,{min:e,max:t,output:l}),s.setRow(n,l)}return s}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let s=new I(this.rows,this.columns);for(let n=0;n<this.columns;n++){const l=this.getColumn(n);l.length&&i(l,{min:e,max:t,output:l}),s.setColumn(n,l)}return s}flipRows(){const r=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<r;t++){let s=this.get(e,t),n=this.get(e,this.columns-1-t);this.set(e,t,n),this.set(e,this.columns-1-t,s)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<r;t++){let s=this.get(t,e),n=this.get(this.rows-1-t,e);this.set(t,e,n),this.set(this.rows-1-t,e,s)}return this}kroneckerProduct(r){r=I.checkMatrix(r);let e=this.rows,t=this.columns,s=r.rows,n=r.columns,l=new I(e*s,t*n);for(let h=0;h<e;h++)for(let u=0;u<t;u++)for(let f=0;f<s;f++)for(let p=0;p<n;p++)l.set(s*h+f,n*u+p,this.get(h,u)*r.get(f,p));return l}kroneckerSum(r){if(r=I.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=r.rows,s=this.kroneckerProduct(I.eye(t,t)),n=I.eye(e,e).kroneckerProduct(r);return s.add(n)}transpose(){let r=new I(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.set(t,e,this.get(e,t));return r}sortRows(r=Re){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(r));return this}sortColumns(r=Re){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(r));return this}subMatrix(r,e,t,s){Pt(this,r,e,t,s);let n=new I(e-r+1,s-t+1);for(let l=r;l<=e;l++)for(let h=t;h<=s;h++)n.set(l-r,h-t,this.get(l,h));return n}subMatrixRow(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let s=new I(r.length,t-e+1);for(let n=0;n<r.length;n++)for(let l=e;l<=t;l++){if(r[n]<0||r[n]>=this.rows)throw new RangeError(`Row index out of range: ${r[n]}`);s.set(n,l-e,this.get(r[n],l))}return s}subMatrixColumn(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let s=new I(t-e+1,r.length);for(let n=0;n<r.length;n++)for(let l=e;l<=t;l++){if(r[n]<0||r[n]>=this.columns)throw new RangeError(`Column index out of range: ${r[n]}`);s.set(l-e,n,this.get(l,r[n]))}return s}setSubMatrix(r,e,t){if(r=I.checkMatrix(r),r.isEmpty())return this;let s=e+r.rows-1,n=t+r.columns-1;Pt(this,e,s,t,n);for(let l=0;l<r.rows;l++)for(let h=0;h<r.columns;h++)this.set(e+l,t+h,r.get(l,h));return this}selection(r,e){ct(this,r),Bt(this,e);let t=new I(r.length,e.length);for(let s=0;s<r.length;s++){let n=r[s];for(let l=0;l<e.length;l++){let h=e[l];t.set(s,l,this.get(n,h))}}return t}trace(){let r=Math.min(this.rows,this.columns),e=0;for(let t=0;t<r;t++)e+=this.get(t,t);return e}clone(){return this.constructor.copy(this,new I(this.rows,this.columns))}static copy(r,e){for(const[t,s,n]of r.entries())e.set(t,s,n);return e}sum(r){switch(r){case"row":return ne(this);case"column":return oe(this);case void 0:return ie(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return J(this);case"column":return P(this);case void 0:return K(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const e=this.sum(r);switch(r){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:s=this.mean(r)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!a.isAnyArray(s))throw new TypeError("mean must be an array");return ht(this,t,s)}case"column":{if(!a.isAnyArray(s))throw new TypeError("mean must be an array");return jt(this,t,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return et(this,t,s)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,e){typeof r=="object"&&(e=r,r=void 0);const t=this.variance(r,e);if(r===void 0)return Math.sqrt(t);for(let s=0;s<t.length;s++)t[s]=Math.sqrt(t[s]);return t}center(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(r)}=e;switch(r){case"row":{if(!a.isAnyArray(t))throw new TypeError("center must be an array");return mt(this,t),this}case"column":{if(!a.isAnyArray(t))throw new TypeError("center must be an array");return Tt(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Ge(this,t),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(r){case"row":{if(t===void 0)t=Ke(this);else if(!a.isAnyArray(t))throw new TypeError("scale must be an array");return Ze(this,t),this}case"column":{if(t===void 0)t=Ae(this);else if(!a.isAnyArray(t))throw new TypeError("scale must be an array");return He(this,t),this}case void 0:{if(t===void 0)t=ts(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return es(this,t),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return E(this,r)}[Symbol.iterator](){return this.entries()}*entries(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield[r,e,this.get(r,e)]}*values(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield this.get(r,e)}}z.prototype.klass="Matrix",typeof Symbol<"u"&&(z.prototype[Symbol.for("nodejs.util.inspect.custom")]=M);function Re(o,r){return o-r}function ss(o){return o.every(r=>typeof r=="number")}z.random=z.rand,z.randomInt=z.randInt,z.diagonal=z.diag,z.prototype.diagonal=z.prototype.diag,z.identity=z.eye,z.prototype.negate=z.prototype.neg,z.prototype.tensorProduct=z.prototype.kroneckerProduct;const Gt=class Gt extends z{constructor(e,t){super();ue(this,zt);qe(this,"data");if(Gt.isMatrix(e))fe(this,zt,Me).call(this,e.rows,e.columns),Gt.copy(e,this);else if(Number.isInteger(e)&&e>=0)fe(this,zt,Me).call(this,e,t);else if(a.isAnyArray(e)){const s=e;if(e=s.length,t=e?s[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(s[n].length!==t)throw new RangeError("Inconsistent array dimensions");if(!ss(s[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(s[n]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,s){return this.data[e][t]=s,this}get(e,t){return this.data[e][t]}removeRow(e){return _(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),_(this,e,!0),t=Float64Array.from(tt(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){U(this,e);for(let t=0;t<this.rows;t++){const s=new Float64Array(this.columns-1);for(let n=0;n<e;n++)s[n]=this.data[t][n];for(let n=e+1;n<this.columns;n++)s[n-1]=this.data[t][n];this.data[t]=s}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),U(this,e,!0),t=gt(this,t);for(let s=0;s<this.rows;s++){const n=new Float64Array(this.columns+1);let l=0;for(;l<e;l++)n[l]=this.data[s][l];for(n[l++]=t[s];l<this.columns+1;l++)n[l]=this.data[s][l-1];this.data[s]=n}return this.columns+=1,this}};zt=new WeakSet,Me=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let s=0;s<e;s++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t};let I=Gt;O(z,I);const Kt=class Kt extends z{constructor(e){super();ue(this,it);if(I.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");Zt(this,it,I.copy(e,new I(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)Zt(this,it,new I(e,e));else if(Zt(this,it,new I(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return pt(this,it).size}get rows(){return pt(this,it).rows}get columns(){return pt(this,it).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return I.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new Kt(this.diagonalSize);for(const[t,s,n]of this.upperRightEntries())e.set(t,s,n);return e}toMatrix(){return new I(this)}get(e,t){return pt(this,it).get(e,t)}set(e,t,s){return pt(this,it).set(e,t,s),pt(this,it).set(t,e,s),this}removeCross(e){return pt(this,it).removeRow(e),pt(this,it).removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const s=t.slice();return s.splice(e,1),pt(this,it).addRow(e,s),pt(this,it).addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[s,n]of e.entries())n||t.push(s);t.reverse();for(const s of t)this.removeCross(s);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let s=0,n=0,l=0;l<t.length;l++)t[l]=this.get(n,s),++s>=e&&(s=++n);return t}static fromCompact(e){const t=e.length,s=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const n=new Kt(s);for(let l=0,h=0,u=0;u<t;u++)n.set(l,h,e[u]),++l>=s&&(l=++h);return n}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const s=this.get(e,t);yield[e,t,s],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};it=new WeakMap;let Ft=Kt;Ft.prototype.klassType="SymmetricMatrix";class Xt extends Ft{static isDistanceMatrix(r){return Ft.isSymmetricMatrix(r)&&r.klassSubType==="DistanceMatrix"}constructor(r){if(super(r),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(r,e,t){return r===e&&(t=0),super.set(r,e,t)}addCross(r,e){return e===void 0&&(e=r,r=this.diagonalSize),e=e.slice(),e[r]=0,super.addCross(r,e)}toSymmetricMatrix(){return new Ft(this)}clone(){const r=new Xt(this.diagonalSize);for(const[e,t,s]of this.upperRightEntries())e!==t&&r.set(e,t,s);return r}toCompact(){const{diagonalSize:r}=this,e=(r-1)*r/2,t=new Array(e);for(let s=1,n=0,l=0;l<t.length;l++)t[l]=this.get(n,s),++s>=r&&(s=++n+1);return t}static fromCompact(r){const e=r.length;if(e===0)return new this(0);const t=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(r)}`);const s=new this(t);for(let n=1,l=0,h=0;h<e;h++)s.set(n,l,r[h]),++n>=t&&(n=++l+1);return s}}Xt.prototype.klassSubType="DistanceMatrix";class Et extends z{constructor(r,e,t){super(),this.matrix=r,this.rows=e,this.columns=t}}class rs extends Et{constructor(r,e){U(r,e),super(r,r.rows,1),this.column=e}set(r,e,t){return this.matrix.set(r,this.column,t),this}get(r){return this.matrix.get(r,this.column)}}class ns extends Et{constructor(r,e){Bt(r,e),super(r,r.rows,e.length),this.columnIndices=e}set(r,e,t){return this.matrix.set(r,this.columnIndices[e],t),this}get(r,e){return this.matrix.get(r,this.columnIndices[e])}}class os extends Et{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(r,this.columns-e-1,t),this}get(r,e){return this.matrix.get(r,this.columns-e-1)}}class is extends Et{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(this.rows-r-1,e,t),this}get(r,e){return this.matrix.get(this.rows-r-1,e)}}class ls extends Et{constructor(r,e){_(r,e),super(r,1,r.columns),this.row=e}set(r,e,t){return this.matrix.set(this.row,e,t),this}get(r,e){return this.matrix.get(this.row,e)}}class hs extends Et{constructor(r,e){ct(r,e),super(r,e.length,r.columns),this.rowIndices=e}set(r,e,t){return this.matrix.set(this.rowIndices[r],e,t),this}get(r,e){return this.matrix.get(this.rowIndices[r],e)}}class Wt extends Et{constructor(r,e,t){ct(r,e),Bt(r,t),super(r,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(r,e,t){return this.matrix.set(this.rowIndices[r],this.columnIndices[e],t),this}get(r,e){return this.matrix.get(this.rowIndices[r],this.columnIndices[e])}}class us extends Et{constructor(r,e,t,s,n){Pt(r,e,t,s,n),super(r,t-e+1,n-s+1),this.startRow=e,this.startColumn=s}set(r,e,t){return this.matrix.set(this.startRow+r,this.startColumn+e,t),this}get(r,e){return this.matrix.get(this.startRow+r,this.startColumn+e)}}class fs extends Et{constructor(r){super(r,r.columns,r.rows)}set(r,e,t){return this.matrix.set(e,r,t),this}get(r,e){return this.matrix.get(e,r)}}class Ne extends z{constructor(r,e={}){const{rows:t=1}=e;if(r.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=r.length/t,this.data=r}set(r,e,t){let s=this._calculateIndex(r,e);return this.data[s]=t,this}get(r,e){let t=this._calculateIndex(r,e);return this.data[t]}_calculateIndex(r,e){return r*this.columns+e}}class ut extends z{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,t){return this.data[r][e]=t,this}get(r,e){return this.data[r][e]}}function as(o,r){if(a.isAnyArray(o))return o[0]&&a.isAnyArray(o[0])?new ut(o):new Ne(o,r);throw new Error("the argument is not an array")}class Jt{constructor(r){r=ut.checkMatrix(r);let e=r.clone(),t=e.rows,s=e.columns,n=new Float64Array(t),l=1,h,u,f,p,m,b,N,y,j;for(h=0;h<t;h++)n[h]=h;for(y=new Float64Array(t),u=0;u<s;u++){for(h=0;h<t;h++)y[h]=e.get(h,u);for(h=0;h<t;h++){for(j=Math.min(h,u),m=0,f=0;f<j;f++)m+=e.get(h,f)*y[f];y[h]-=m,e.set(h,u,y[h])}for(p=u,h=u+1;h<t;h++)Math.abs(y[h])>Math.abs(y[p])&&(p=h);if(p!==u){for(f=0;f<s;f++)b=e.get(p,f),e.set(p,f,e.get(u,f)),e.set(u,f,b);N=n[p],n[p]=n[u],n[u]=N,l=-l}if(u<t&&e.get(u,u)!==0)for(h=u+1;h<t;h++)e.set(h,u,e.get(h,u)/e.get(u,u))}this.LU=e,this.pivotVector=n,this.pivotSign=l}isSingular(){let r=this.LU,e=r.columns;for(let t=0;t<e;t++)if(r.get(t,t)===0)return!0;return!1}solve(r){r=I.checkMatrix(r);let e=this.LU;if(e.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=r.columns,n=r.subMatrixRow(this.pivotVector,0,s-1),l=e.columns,h,u,f;for(f=0;f<l;f++)for(h=f+1;h<l;h++)for(u=0;u<s;u++)n.set(h,u,n.get(h,u)-n.get(f,u)*e.get(h,f));for(f=l-1;f>=0;f--){for(u=0;u<s;u++)n.set(f,u,n.get(f,u)/e.get(f,f));for(h=0;h<f;h++)for(u=0;u<s;u++)n.set(h,u,n.get(h,u)-n.get(f,u)*e.get(h,f))}return n}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=r.columns;for(let s=0;s<t;s++)e*=r.get(s,s);return e}get lowerTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,s=new I(e,t);for(let n=0;n<e;n++)for(let l=0;l<t;l++)n>l?s.set(n,l,r.get(n,l)):n===l?s.set(n,l,1):s.set(n,l,0);return s}get upperTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,s=new I(e,t);for(let n=0;n<e;n++)for(let l=0;l<t;l++)n<=l?s.set(n,l,r.get(n,l)):s.set(n,l,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function St(o,r){let e=0;return Math.abs(o)>Math.abs(r)?(e=r/o,Math.abs(o)*Math.sqrt(1+e*e)):r!==0?(e=o/r,Math.abs(r)*Math.sqrt(1+e*e)):0}class le{constructor(r){r=ut.checkMatrix(r);let e=r.clone(),t=r.rows,s=r.columns,n=new Float64Array(s),l,h,u,f;for(u=0;u<s;u++){let p=0;for(l=u;l<t;l++)p=St(p,e.get(l,u));if(p!==0){for(e.get(u,u)<0&&(p=-p),l=u;l<t;l++)e.set(l,u,e.get(l,u)/p);for(e.set(u,u,e.get(u,u)+1),h=u+1;h<s;h++){for(f=0,l=u;l<t;l++)f+=e.get(l,u)*e.get(l,h);for(f=-f/e.get(u,u),l=u;l<t;l++)e.set(l,h,e.get(l,h)+f*e.get(l,u))}}n[u]=-p}this.QR=e,this.Rdiag=n}solve(r){r=I.checkMatrix(r);let e=this.QR,t=e.rows;if(r.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=r.columns,n=r.clone(),l=e.columns,h,u,f,p;for(f=0;f<l;f++)for(u=0;u<s;u++){for(p=0,h=f;h<t;h++)p+=e.get(h,f)*n.get(h,u);for(p=-p/e.get(f,f),h=f;h<t;h++)n.set(h,u,n.get(h,u)+p*e.get(h,f))}for(f=l-1;f>=0;f--){for(u=0;u<s;u++)n.set(f,u,n.get(f,u)/this.Rdiag[f]);for(h=0;h<f;h++)for(u=0;u<s;u++)n.set(h,u,n.get(h,u)-n.get(f,u)*e.get(h,f))}return n.subMatrix(0,l-1,0,s-1)}isFullRank(){let r=this.QR.columns;for(let e=0;e<r;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,e=r.columns,t=new I(e,e),s,n;for(s=0;s<e;s++)for(n=0;n<e;n++)s<n?t.set(s,n,r.get(s,n)):s===n?t.set(s,n,this.Rdiag[s]):t.set(s,n,0);return t}get orthogonalMatrix(){let r=this.QR,e=r.rows,t=r.columns,s=new I(e,t),n,l,h,u;for(h=t-1;h>=0;h--){for(n=0;n<e;n++)s.set(n,h,0);for(s.set(h,h,1),l=h;l<t;l++)if(r.get(h,h)!==0){for(u=0,n=h;n<e;n++)u+=r.get(n,h)*s.get(n,l);for(u=-u/r.get(h,h),n=h;n<e;n++)s.set(n,l,s.get(n,l)+u*r.get(n,h))}}return s}}class Vt{constructor(r,e={}){if(r=ut.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let t=r.rows,s=r.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:l=!0,autoTranspose:h=!1}=e;let u=!!n,f=!!l,p=!1,m;if(t<s)if(!h)m=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{m=r.transpose(),t=m.rows,s=m.columns,p=!0;let w=u;u=f,f=w}else m=r.clone();let b=Math.min(t,s),N=Math.min(t+1,s),y=new Float64Array(N),j=new I(t,b),F=new I(s,s),g=new Float64Array(s),R=new Float64Array(t),q=new Float64Array(N);for(let w=0;w<N;w++)q[w]=w;let L=Math.min(t-1,s),B=Math.max(0,Math.min(s-2,t)),Z=Math.max(L,B);for(let w=0;w<Z;w++){if(w<L){y[w]=0;for(let S=w;S<t;S++)y[w]=St(y[w],m.get(S,w));if(y[w]!==0){m.get(w,w)<0&&(y[w]=-y[w]);for(let S=w;S<t;S++)m.set(S,w,m.get(S,w)/y[w]);m.set(w,w,m.get(w,w)+1)}y[w]=-y[w]}for(let S=w+1;S<s;S++){if(w<L&&y[w]!==0){let C=0;for(let x=w;x<t;x++)C+=m.get(x,w)*m.get(x,S);C=-C/m.get(w,w);for(let x=w;x<t;x++)m.set(x,S,m.get(x,S)+C*m.get(x,w))}g[S]=m.get(w,S)}if(u&&w<L)for(let S=w;S<t;S++)j.set(S,w,m.get(S,w));if(w<B){g[w]=0;for(let S=w+1;S<s;S++)g[w]=St(g[w],g[S]);if(g[w]!==0){g[w+1]<0&&(g[w]=0-g[w]);for(let S=w+1;S<s;S++)g[S]/=g[w];g[w+1]+=1}if(g[w]=-g[w],w+1<t&&g[w]!==0){for(let S=w+1;S<t;S++)R[S]=0;for(let S=w+1;S<t;S++)for(let C=w+1;C<s;C++)R[S]+=g[C]*m.get(S,C);for(let S=w+1;S<s;S++){let C=-g[S]/g[w+1];for(let x=w+1;x<t;x++)m.set(x,S,m.get(x,S)+C*R[x])}}if(f)for(let S=w+1;S<s;S++)F.set(S,w,g[S])}}let D=Math.min(s,t+1);if(L<s&&(y[L]=m.get(L,L)),t<D&&(y[D-1]=0),B+1<D&&(g[B]=m.get(B,D-1)),g[D-1]=0,u){for(let w=L;w<b;w++){for(let S=0;S<t;S++)j.set(S,w,0);j.set(w,w,1)}for(let w=L-1;w>=0;w--)if(y[w]!==0){for(let S=w+1;S<b;S++){let C=0;for(let x=w;x<t;x++)C+=j.get(x,w)*j.get(x,S);C=-C/j.get(w,w);for(let x=w;x<t;x++)j.set(x,S,j.get(x,S)+C*j.get(x,w))}for(let S=w;S<t;S++)j.set(S,w,-j.get(S,w));j.set(w,w,1+j.get(w,w));for(let S=0;S<w-1;S++)j.set(S,w,0)}else{for(let S=0;S<t;S++)j.set(S,w,0);j.set(w,w,1)}}if(f)for(let w=s-1;w>=0;w--){if(w<B&&g[w]!==0)for(let S=w+1;S<s;S++){let C=0;for(let x=w+1;x<s;x++)C+=F.get(x,w)*F.get(x,S);C=-C/F.get(w+1,w);for(let x=w+1;x<s;x++)F.set(x,S,F.get(x,S)+C*F.get(x,w))}for(let S=0;S<s;S++)F.set(S,w,0);F.set(w,w,1)}let $=D-1,Q=Number.EPSILON;for(;D>0;){let w,S;for(w=D-2;w>=-1&&w!==-1;w--){const C=Number.MIN_VALUE+Q*Math.abs(y[w]+Math.abs(y[w+1]));if(Math.abs(g[w])<=C||Number.isNaN(g[w])){g[w]=0;break}}if(w===D-2)S=4;else{let C;for(C=D-1;C>=w&&C!==w;C--){let x=(C!==D?Math.abs(g[C]):0)+(C!==w+1?Math.abs(g[C-1]):0);if(Math.abs(y[C])<=Q*x){y[C]=0;break}}C===w?S=3:C===D-1?S=1:(S=2,w=C)}switch(w++,S){case 1:{let C=g[D-2];g[D-2]=0;for(let x=D-2;x>=w;x--){let A=St(y[x],C),Y=y[x]/A,G=C/A;if(y[x]=A,x!==w&&(C=-G*g[x-1],g[x-1]=Y*g[x-1]),f)for(let H=0;H<s;H++)A=Y*F.get(H,x)+G*F.get(H,D-1),F.set(H,D-1,-G*F.get(H,x)+Y*F.get(H,D-1)),F.set(H,x,A)}break}case 2:{let C=g[w-1];g[w-1]=0;for(let x=w;x<D;x++){let A=St(y[x],C),Y=y[x]/A,G=C/A;if(y[x]=A,C=-G*g[x],g[x]=Y*g[x],u)for(let H=0;H<t;H++)A=Y*j.get(H,x)+G*j.get(H,w-1),j.set(H,w-1,-G*j.get(H,x)+Y*j.get(H,w-1)),j.set(H,x,A)}break}case 3:{const C=Math.max(Math.abs(y[D-1]),Math.abs(y[D-2]),Math.abs(g[D-2]),Math.abs(y[w]),Math.abs(g[w])),x=y[D-1]/C,A=y[D-2]/C,Y=g[D-2]/C,G=y[w]/C,H=g[w]/C,nt=((A+x)*(A-x)+Y*Y)/2,wt=x*Y*(x*Y);let st=0;(nt!==0||wt!==0)&&(nt<0?st=0-Math.sqrt(nt*nt+wt):st=Math.sqrt(nt*nt+wt),st=wt/(nt+st));let bt=(G+x)*(G-x)+st,xt=G*H;for(let W=w;W<D-1;W++){let ot=St(bt,xt);ot===0&&(ot=Number.MIN_VALUE);let ft=bt/ot,at=xt/ot;if(W!==w&&(g[W-1]=ot),bt=ft*y[W]+at*g[W],g[W]=ft*g[W]-at*y[W],xt=at*y[W+1],y[W+1]=ft*y[W+1],f)for(let rt=0;rt<s;rt++)ot=ft*F.get(rt,W)+at*F.get(rt,W+1),F.set(rt,W+1,-at*F.get(rt,W)+ft*F.get(rt,W+1)),F.set(rt,W,ot);if(ot=St(bt,xt),ot===0&&(ot=Number.MIN_VALUE),ft=bt/ot,at=xt/ot,y[W]=ot,bt=ft*g[W]+at*y[W+1],y[W+1]=-at*g[W]+ft*y[W+1],xt=at*g[W+1],g[W+1]=ft*g[W+1],u&&W<t-1)for(let rt=0;rt<t;rt++)ot=ft*j.get(rt,W)+at*j.get(rt,W+1),j.set(rt,W+1,-at*j.get(rt,W)+ft*j.get(rt,W+1)),j.set(rt,W,ot)}g[D-2]=bt;break}case 4:{if(y[w]<=0&&(y[w]=y[w]<0?-y[w]:0,f))for(let C=0;C<=$;C++)F.set(C,w,-F.get(C,w));for(;w<$&&!(y[w]>=y[w+1]);){let C=y[w];if(y[w]=y[w+1],y[w+1]=C,f&&w<s-1)for(let x=0;x<s;x++)C=F.get(x,w+1),F.set(x,w+1,F.get(x,w)),F.set(x,w,C);if(u&&w<t-1)for(let x=0;x<t;x++)C=j.get(x,w+1),j.set(x,w+1,j.get(x,w)),j.set(x,w,C);w++}D--;break}}}if(p){let w=F;F=j,j=w}this.m=t,this.n=s,this.s=y,this.U=j,this.V=F}solve(r){let e=r,t=this.threshold,s=this.s.length,n=I.zeros(s,s);for(let b=0;b<s;b++)Math.abs(this.s[b])<=t?n.set(b,b,0):n.set(b,b,1/this.s[b]);let l=this.U,h=this.rightSingularVectors,u=h.mmul(n),f=h.rows,p=l.rows,m=I.zeros(f,p);for(let b=0;b<f;b++)for(let N=0;N<p;N++){let y=0;for(let j=0;j<s;j++)y+=u.get(b,j)*l.get(N,j);m.set(b,N,y)}return m.mmul(e)}solveForDiagonal(r){return this.solve(I.diag(r))}inverse(){let r=this.V,e=this.threshold,t=r.rows,s=r.columns,n=new I(t,this.s.length);for(let p=0;p<t;p++)for(let m=0;m<s;m++)Math.abs(this.s[m])>e&&n.set(p,m,r.get(p,m)/this.s[m]);let l=this.U,h=l.rows,u=l.columns,f=new I(t,h);for(let p=0;p<t;p++)for(let m=0;m<h;m++){let b=0;for(let N=0;N<u;N++)b+=n.get(p,N)*l.get(m,N);f.set(p,m,b)}return f}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let s=0,n=t.length;s<n;s++)t[s]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return I.diag(this.s)}}function cs(o,r=!1){return o=ut.checkMatrix(o),r?new Vt(o).inverse():ve(o,I.eye(o.rows))}function ve(o,r,e=!1){return o=ut.checkMatrix(o),r=ut.checkMatrix(r),e?new Vt(o).solve(r):o.isSquare()?new Jt(o).solve(r):new le(o).solve(r)}function Yt(o){if(o=I.checkMatrix(o),o.isSquare()){if(o.columns===0)return 1;let r,e,t,s;if(o.columns===2)return r=o.get(0,0),e=o.get(0,1),t=o.get(1,0),s=o.get(1,1),r*s-e*t;if(o.columns===3){let n,l,h;return n=new Wt(o,[1,2],[1,2]),l=new Wt(o,[1,2],[0,2]),h=new Wt(o,[1,2],[0,1]),r=o.get(0,0),e=o.get(0,1),t=o.get(0,2),r*Yt(n)-e*Yt(l)+t*Yt(h)}else return new Jt(o).determinant}else throw Error("determinant can only be calculated for a square matrix")}function ms(o,r){let e=[];for(let t=0;t<o;t++)t!==r&&e.push(t);return e}function gs(o,r,e,t=1e-9,s=1e-9){if(o>s)return new Array(r.rows+1).fill(0);{let n=r.addRow(e,[0]);for(let l=0;l<n.rows;l++)Math.abs(n.get(l,0))<t&&n.set(l,0,0);return n.to1DArray()}}function ws(o,r={}){const{thresholdValue:e=1e-9,thresholdError:t=1e-9}=r;o=I.checkMatrix(o);let s=o.rows,n=new I(s,s);for(let l=0;l<s;l++){let h=I.columnVector(o.getRow(l)),u=o.subMatrixRow(ms(s,l)).transpose(),p=new Vt(u).solve(h),m=I.sub(h,u.mmul(p)).abs().max();n.setRow(l,gs(m,p,l,e,t))}return n}function ps(o,r=Number.EPSILON){if(o=I.checkMatrix(o),o.isEmpty())return o.transpose();let e=new Vt(o,{autoTranspose:!0}),t=e.leftSingularVectors,s=e.rightSingularVectors,n=e.diagonal;for(let l=0;l<n.length;l++)Math.abs(n[l])>r?n[l]=1/n[l]:n[l]=0;return s.mmul(I.diag(n).mmul(t.transpose()))}function ds(o,r=o,e={}){o=new I(o);let t=!1;if(typeof r=="object"&&!I.isMatrix(r)&&!a.isAnyArray(r)?(e=r,r=o,t=!0):r=new I(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=e;s&&(o=o.center("column"),t||(r=r.center("column")));const n=o.transpose().mmul(r);for(let l=0;l<n.rows;l++)for(let h=0;h<n.columns;h++)n.set(l,h,n.get(l,h)*(1/(o.rows-1)));return n}function ys(o,r=o,e={}){o=new I(o);let t=!1;if(typeof r=="object"&&!I.isMatrix(r)&&!a.isAnyArray(r)?(e=r,r=o,t=!0):r=new I(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:n=!0}=e;s&&(o.center("column"),t||r.center("column")),n&&(o.scale("column"),t||r.scale("column"));const l=o.standardDeviation("column",{unbiased:!0}),h=t?l:r.standardDeviation("column",{unbiased:!0}),u=o.transpose().mmul(r);for(let f=0;f<u.rows;f++)for(let p=0;p<u.columns;p++)u.set(f,p,u.get(f,p)*(1/(l[f]*h[p]))*(1/(o.rows-1)));return u}class Ie{constructor(r,e={}){const{assumeSymmetric:t=!1}=e;if(r=ut.checkMatrix(r),!r.isSquare())throw new Error("Matrix is not a square matrix");if(r.isEmpty())throw new Error("Matrix must be non-empty");let s=r.columns,n=new I(s,s),l=new Float64Array(s),h=new Float64Array(s),u=r,f,p,m=!1;if(t?m=!0:m=r.isSymmetric(),m){for(f=0;f<s;f++)for(p=0;p<s;p++)n.set(f,p,u.get(f,p));bs(s,h,l,n),Ms(s,h,l,n)}else{let b=new I(s,s),N=new Float64Array(s);for(p=0;p<s;p++)for(f=0;f<s;f++)b.set(f,p,u.get(f,p));js(s,b,N,n),Es(s,h,l,n,b)}this.n=s,this.e=h,this.d=l,this.V=n}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let r=this.n,e=this.e,t=this.d,s=new I(r,r),n,l;for(n=0;n<r;n++){for(l=0;l<r;l++)s.set(n,l,0);s.set(n,n,t[n]),e[n]>0?s.set(n,n+1,e[n]):e[n]<0&&s.set(n,n-1,e[n])}return s}}function bs(o,r,e,t){let s,n,l,h,u,f,p,m;for(u=0;u<o;u++)e[u]=t.get(o-1,u);for(h=o-1;h>0;h--){for(m=0,l=0,f=0;f<h;f++)m=m+Math.abs(e[f]);if(m===0)for(r[h]=e[h-1],u=0;u<h;u++)e[u]=t.get(h-1,u),t.set(h,u,0),t.set(u,h,0);else{for(f=0;f<h;f++)e[f]/=m,l+=e[f]*e[f];for(s=e[h-1],n=Math.sqrt(l),s>0&&(n=-n),r[h]=m*n,l=l-s*n,e[h-1]=s-n,u=0;u<h;u++)r[u]=0;for(u=0;u<h;u++){for(s=e[u],t.set(u,h,s),n=r[u]+t.get(u,u)*s,f=u+1;f<=h-1;f++)n+=t.get(f,u)*e[f],r[f]+=t.get(f,u)*s;r[u]=n}for(s=0,u=0;u<h;u++)r[u]/=l,s+=r[u]*e[u];for(p=s/(l+l),u=0;u<h;u++)r[u]-=p*e[u];for(u=0;u<h;u++){for(s=e[u],n=r[u],f=u;f<=h-1;f++)t.set(f,u,t.get(f,u)-(s*r[f]+n*e[f]));e[u]=t.get(h-1,u),t.set(h,u,0)}}e[h]=l}for(h=0;h<o-1;h++){if(t.set(o-1,h,t.get(h,h)),t.set(h,h,1),l=e[h+1],l!==0){for(f=0;f<=h;f++)e[f]=t.get(f,h+1)/l;for(u=0;u<=h;u++){for(n=0,f=0;f<=h;f++)n+=t.get(f,h+1)*t.get(f,u);for(f=0;f<=h;f++)t.set(f,u,t.get(f,u)-n*e[f])}}for(f=0;f<=h;f++)t.set(f,h+1,0)}for(u=0;u<o;u++)e[u]=t.get(o-1,u),t.set(o-1,u,0);t.set(o-1,o-1,1),r[0]=0}function Ms(o,r,e,t){let s,n,l,h,u,f,p,m,b,N,y,j,F,g,R,q;for(l=1;l<o;l++)r[l-1]=r[l];r[o-1]=0;let L=0,B=0,Z=Number.EPSILON;for(f=0;f<o;f++){for(B=Math.max(B,Math.abs(e[f])+Math.abs(r[f])),p=f;p<o&&!(Math.abs(r[p])<=Z*B);)p++;if(p>f)do{for(s=e[f],m=(e[f+1]-s)/(2*r[f]),b=St(m,1),m<0&&(b=-b),e[f]=r[f]/(m+b),e[f+1]=r[f]*(m+b),N=e[f+1],n=s-e[f],l=f+2;l<o;l++)e[l]-=n;for(L=L+n,m=e[p],y=1,j=y,F=y,g=r[f+1],R=0,q=0,l=p-1;l>=f;l--)for(F=j,j=y,q=R,s=y*r[l],n=y*m,b=St(m,r[l]),r[l+1]=R*b,R=r[l]/b,y=m/b,m=y*e[l]-R*s,e[l+1]=n+R*(y*s+R*e[l]),u=0;u<o;u++)n=t.get(u,l+1),t.set(u,l+1,R*t.get(u,l)+y*n),t.set(u,l,y*t.get(u,l)-R*n);m=-R*q*F*g*r[f]/N,r[f]=R*m,e[f]=y*m}while(Math.abs(r[f])>Z*B);e[f]=e[f]+L,r[f]=0}for(l=0;l<o-1;l++){for(u=l,m=e[l],h=l+1;h<o;h++)e[h]<m&&(u=h,m=e[h]);if(u!==l)for(e[u]=e[l],e[l]=m,h=0;h<o;h++)m=t.get(h,l),t.set(h,l,t.get(h,u)),t.set(h,u,m)}}function js(o,r,e,t){let s=0,n=o-1,l,h,u,f,p,m,b;for(m=s+1;m<=n-1;m++){for(b=0,f=m;f<=n;f++)b=b+Math.abs(r.get(f,m-1));if(b!==0){for(u=0,f=n;f>=m;f--)e[f]=r.get(f,m-1)/b,u+=e[f]*e[f];for(h=Math.sqrt(u),e[m]>0&&(h=-h),u=u-e[m]*h,e[m]=e[m]-h,p=m;p<o;p++){for(l=0,f=n;f>=m;f--)l+=e[f]*r.get(f,p);for(l=l/u,f=m;f<=n;f++)r.set(f,p,r.get(f,p)-l*e[f])}for(f=0;f<=n;f++){for(l=0,p=n;p>=m;p--)l+=e[p]*r.get(f,p);for(l=l/u,p=m;p<=n;p++)r.set(f,p,r.get(f,p)-l*e[p])}e[m]=b*e[m],r.set(m,m-1,b*h)}}for(f=0;f<o;f++)for(p=0;p<o;p++)t.set(f,p,f===p?1:0);for(m=n-1;m>=s+1;m--)if(r.get(m,m-1)!==0){for(f=m+1;f<=n;f++)e[f]=r.get(f,m-1);for(p=m;p<=n;p++){for(h=0,f=m;f<=n;f++)h+=e[f]*t.get(f,p);for(h=h/e[m]/r.get(m,m-1),f=m;f<=n;f++)t.set(f,p,t.get(f,p)+h*e[f])}}}function Es(o,r,e,t,s){let n=o-1,l=0,h=o-1,u=Number.EPSILON,f=0,p=0,m=0,b=0,N=0,y=0,j=0,F=0,g,R,q,L,B,Z,D,$,Q,w,S,C,x,A,Y;for(g=0;g<o;g++)for((g<l||g>h)&&(e[g]=s.get(g,g),r[g]=0),R=Math.max(g-1,0);R<o;R++)p=p+Math.abs(s.get(g,R));for(;n>=l;){for(L=n;L>l&&(y=Math.abs(s.get(L-1,L-1))+Math.abs(s.get(L,L)),y===0&&(y=p),!(Math.abs(s.get(L,L-1))<u*y));)L--;if(L===n)s.set(n,n,s.get(n,n)+f),e[n]=s.get(n,n),r[n]=0,n--,F=0;else if(L===n-1){if(D=s.get(n,n-1)*s.get(n-1,n),m=(s.get(n-1,n-1)-s.get(n,n))/2,b=m*m+D,j=Math.sqrt(Math.abs(b)),s.set(n,n,s.get(n,n)+f),s.set(n-1,n-1,s.get(n-1,n-1)+f),$=s.get(n,n),b>=0){for(j=m>=0?m+j:m-j,e[n-1]=$+j,e[n]=e[n-1],j!==0&&(e[n]=$-D/j),r[n-1]=0,r[n]=0,$=s.get(n,n-1),y=Math.abs($)+Math.abs(j),m=$/y,b=j/y,N=Math.sqrt(m*m+b*b),m=m/N,b=b/N,R=n-1;R<o;R++)j=s.get(n-1,R),s.set(n-1,R,b*j+m*s.get(n,R)),s.set(n,R,b*s.get(n,R)-m*j);for(g=0;g<=n;g++)j=s.get(g,n-1),s.set(g,n-1,b*j+m*s.get(g,n)),s.set(g,n,b*s.get(g,n)-m*j);for(g=l;g<=h;g++)j=t.get(g,n-1),t.set(g,n-1,b*j+m*t.get(g,n)),t.set(g,n,b*t.get(g,n)-m*j)}else e[n-1]=$+m,e[n]=$+m,r[n-1]=j,r[n]=-j;n=n-2,F=0}else{if($=s.get(n,n),Q=0,D=0,L<n&&(Q=s.get(n-1,n-1),D=s.get(n,n-1)*s.get(n-1,n)),F===10){for(f+=$,g=l;g<=n;g++)s.set(g,g,s.get(g,g)-$);y=Math.abs(s.get(n,n-1))+Math.abs(s.get(n-1,n-2)),$=Q=.75*y,D=-.4375*y*y}if(F===30&&(y=(Q-$)/2,y=y*y+D,y>0)){for(y=Math.sqrt(y),Q<$&&(y=-y),y=$-D/((Q-$)/2+y),g=l;g<=n;g++)s.set(g,g,s.get(g,g)-y);f+=y,$=Q=D=.964}for(F=F+1,B=n-2;B>=L&&(j=s.get(B,B),N=$-j,y=Q-j,m=(N*y-D)/s.get(B+1,B)+s.get(B,B+1),b=s.get(B+1,B+1)-j-N-y,N=s.get(B+2,B+1),y=Math.abs(m)+Math.abs(b)+Math.abs(N),m=m/y,b=b/y,N=N/y,!(B===L||Math.abs(s.get(B,B-1))*(Math.abs(b)+Math.abs(N))<u*(Math.abs(m)*(Math.abs(s.get(B-1,B-1))+Math.abs(j)+Math.abs(s.get(B+1,B+1))))));)B--;for(g=B+2;g<=n;g++)s.set(g,g-2,0),g>B+2&&s.set(g,g-3,0);for(q=B;q<=n-1&&(A=q!==n-1,q!==B&&(m=s.get(q,q-1),b=s.get(q+1,q-1),N=A?s.get(q+2,q-1):0,$=Math.abs(m)+Math.abs(b)+Math.abs(N),$!==0&&(m=m/$,b=b/$,N=N/$)),$!==0);q++)if(y=Math.sqrt(m*m+b*b+N*N),m<0&&(y=-y),y!==0){for(q!==B?s.set(q,q-1,-y*$):L!==B&&s.set(q,q-1,-s.get(q,q-1)),m=m+y,$=m/y,Q=b/y,j=N/y,b=b/m,N=N/m,R=q;R<o;R++)m=s.get(q,R)+b*s.get(q+1,R),A&&(m=m+N*s.get(q+2,R),s.set(q+2,R,s.get(q+2,R)-m*j)),s.set(q,R,s.get(q,R)-m*$),s.set(q+1,R,s.get(q+1,R)-m*Q);for(g=0;g<=Math.min(n,q+3);g++)m=$*s.get(g,q)+Q*s.get(g,q+1),A&&(m=m+j*s.get(g,q+2),s.set(g,q+2,s.get(g,q+2)-m*N)),s.set(g,q,s.get(g,q)-m),s.set(g,q+1,s.get(g,q+1)-m*b);for(g=l;g<=h;g++)m=$*t.get(g,q)+Q*t.get(g,q+1),A&&(m=m+j*t.get(g,q+2),t.set(g,q+2,t.get(g,q+2)-m*N)),t.set(g,q,t.get(g,q)-m),t.set(g,q+1,t.get(g,q+1)-m*b)}}}if(p!==0){for(n=o-1;n>=0;n--)if(m=e[n],b=r[n],b===0)for(L=n,s.set(n,n,1),g=n-1;g>=0;g--){for(D=s.get(g,g)-m,N=0,R=L;R<=n;R++)N=N+s.get(g,R)*s.get(R,n);if(r[g]<0)j=D,y=N;else if(L=g,r[g]===0?s.set(g,n,D!==0?-N/D:-N/(u*p)):($=s.get(g,g+1),Q=s.get(g+1,g),b=(e[g]-m)*(e[g]-m)+r[g]*r[g],Z=($*y-j*N)/b,s.set(g,n,Z),s.set(g+1,n,Math.abs($)>Math.abs(j)?(-N-D*Z)/$:(-y-Q*Z)/j)),Z=Math.abs(s.get(g,n)),u*Z*Z>1)for(R=g;R<=n;R++)s.set(R,n,s.get(R,n)/Z)}else if(b<0)for(L=n-1,Math.abs(s.get(n,n-1))>Math.abs(s.get(n-1,n))?(s.set(n-1,n-1,b/s.get(n,n-1)),s.set(n-1,n,-(s.get(n,n)-m)/s.get(n,n-1))):(Y=Qt(0,-s.get(n-1,n),s.get(n-1,n-1)-m,b),s.set(n-1,n-1,Y[0]),s.set(n-1,n,Y[1])),s.set(n,n-1,0),s.set(n,n,1),g=n-2;g>=0;g--){for(w=0,S=0,R=L;R<=n;R++)w=w+s.get(g,R)*s.get(R,n-1),S=S+s.get(g,R)*s.get(R,n);if(D=s.get(g,g)-m,r[g]<0)j=D,N=w,y=S;else if(L=g,r[g]===0?(Y=Qt(-w,-S,D,b),s.set(g,n-1,Y[0]),s.set(g,n,Y[1])):($=s.get(g,g+1),Q=s.get(g+1,g),C=(e[g]-m)*(e[g]-m)+r[g]*r[g]-b*b,x=(e[g]-m)*2*b,C===0&&x===0&&(C=u*p*(Math.abs(D)+Math.abs(b)+Math.abs($)+Math.abs(Q)+Math.abs(j))),Y=Qt($*N-j*w+b*S,$*y-j*S-b*w,C,x),s.set(g,n-1,Y[0]),s.set(g,n,Y[1]),Math.abs($)>Math.abs(j)+Math.abs(b)?(s.set(g+1,n-1,(-w-D*s.get(g,n-1)+b*s.get(g,n))/$),s.set(g+1,n,(-S-D*s.get(g,n)-b*s.get(g,n-1))/$)):(Y=Qt(-N-Q*s.get(g,n-1),-y-Q*s.get(g,n),j,b),s.set(g+1,n-1,Y[0]),s.set(g+1,n,Y[1]))),Z=Math.max(Math.abs(s.get(g,n-1)),Math.abs(s.get(g,n))),u*Z*Z>1)for(R=g;R<=n;R++)s.set(R,n-1,s.get(R,n-1)/Z),s.set(R,n,s.get(R,n)/Z)}for(g=0;g<o;g++)if(g<l||g>h)for(R=g;R<o;R++)t.set(g,R,s.get(g,R));for(R=o-1;R>=l;R--)for(g=l;g<=h;g++){for(j=0,q=l;q<=Math.min(R,h);q++)j=j+t.get(g,q)*s.get(q,R);t.set(g,R,j)}}}function Qt(o,r,e,t){let s,n;return Math.abs(e)>Math.abs(t)?(s=t/e,n=e+s*t,[(o+s*r)/n,(r-s*o)/n]):(s=e/t,n=t+s*e,[(s*o+r)/n,(s*r-o)/n])}class Te{constructor(r){if(r=ut.checkMatrix(r),!r.isSymmetric())throw new Error("Matrix is not symmetric");let e=r,t=e.rows,s=new I(t,t),n=!0,l,h,u;for(h=0;h<t;h++){let f=0;for(u=0;u<h;u++){let p=0;for(l=0;l<u;l++)p+=s.get(u,l)*s.get(h,l);p=(e.get(h,u)-p)/s.get(u,u),s.set(h,u,p),f=f+p*p}for(f=e.get(h,h)-f,n&&(n=f>0),s.set(h,h,Math.sqrt(Math.max(f,0))),u=h+1;u<t;u++)s.set(h,u,0)}this.L=s,this.positiveDefinite=n}isPositiveDefinite(){return this.positiveDefinite}solve(r){r=ut.checkMatrix(r);let e=this.L,t=e.rows;if(r.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=r.columns,n=r.clone(),l,h,u;for(u=0;u<t;u++)for(h=0;h<s;h++){for(l=0;l<u;l++)n.set(u,h,n.get(u,h)-n.get(l,h)*e.get(u,l));n.set(u,h,n.get(u,h)/e.get(u,u))}for(u=t-1;u>=0;u--)for(h=0;h<s;h++){for(l=u+1;l<t;l++)n.set(u,h,n.get(u,h)-n.get(l,h)*e.get(l,u));n.set(u,h,n.get(u,h)/e.get(u,u))}return n}get lowerTriangularMatrix(){return this.L}}class Fe{constructor(r,e={}){r=ut.checkMatrix(r);let{Y:t}=e;const{scaleScores:s=!1,maxIterations:n=1e3,terminationCriteria:l=1e-10}=e;let h;if(t){if(a.isAnyArray(t)&&typeof t[0]=="number"?t=I.columnVector(t):t=ut.checkMatrix(t),t.rows!==r.rows)throw new Error("Y should have the same number of rows as X");h=t.getColumnVector(0)}else h=r.getColumnVector(0);let u=1,f,p,m,b;for(let N=0;N<n&&u>l;N++)m=r.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),m=m.div(m.norm()),f=r.mmul(m).div(m.transpose().mmul(m).get(0,0)),N>0&&(u=f.clone().sub(b).pow(2).sum()),b=f.clone(),t?(p=t.transpose().mmul(f).div(f.transpose().mmul(f).get(0,0)),p=p.div(p.norm()),h=t.mmul(p).div(p.transpose().mmul(p).get(0,0))):h=f;if(t){let N=r.transpose().mmul(f).div(f.transpose().mmul(f).get(0,0));N=N.div(N.norm());let y=r.clone().sub(f.clone().mmul(N.transpose())),j=h.transpose().mmul(f).div(f.transpose().mmul(f).get(0,0)),F=t.clone().sub(f.clone().mulS(j.get(0,0)).mmul(p.transpose()));this.t=f,this.p=N.transpose(),this.w=m.transpose(),this.q=p,this.u=h,this.s=f.transpose().mmul(f),this.xResidual=y,this.yResidual=F,this.betas=j}else this.w=m.transpose(),this.s=f.transpose().mmul(f).sqrt(),s?this.t=f.clone().div(this.s.get(0,0)):this.t=f,this.xResidual=r.sub(f.mmul(m.transpose()))}}return X.AbstractMatrix=z,X.CHO=Te,X.CholeskyDecomposition=Te,X.DistanceMatrix=Xt,X.EVD=Ie,X.EigenvalueDecomposition=Ie,X.LU=Jt,X.LuDecomposition=Jt,X.Matrix=I,X.MatrixColumnSelectionView=ns,X.MatrixColumnView=rs,X.MatrixFlipColumnView=os,X.MatrixFlipRowView=is,X.MatrixRowSelectionView=hs,X.MatrixRowView=ls,X.MatrixSelectionView=Wt,X.MatrixSubView=us,X.MatrixTransposeView=fs,X.NIPALS=Fe,X.Nipals=Fe,X.QR=le,X.QrDecomposition=le,X.SVD=Vt,X.SingularValueDecomposition=Vt,X.SymmetricMatrix=Ft,X.WrapperMatrix1D=Ne,X.WrapperMatrix2D=ut,X.correlation=ys,X.covariance=ds,X.default=I,X.determinant=Yt,X.inverse=cs,X.linearDependencies=ws,X.pseudoInverse=ps,X.solve=ve,X.wrap=as,X}var Lt=Gs();const De=_e(Lt),lt=Lt.Matrix,$e=Lt.MatrixColumnSelectionView,Ks=Lt.MatrixTransposeView,Zs=Lt.WrapperMatrix2D;De.Matrix?De.Matrix:Lt.Matrix;function As(a){if(!qt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");for(var i=0,c=0;c<a.length;c++)i+=a[c];return i}function Se(a){return As(a)/a.length}function Xe(a,i){let c=new Array(i).fill(0);for(let d=0;d<a.length;++d)c[a[d]]+=1/a.length;return lt.rowVector(c)}function Ve(a){if(a.length===0)return 0;let i=Xe(a,We(a)).getRow(0),c=0;for(let d=0;d<i.length;++d)c+=i[d]*i[d];return 1-c}function We(a){return a.filter((i,c,d)=>d.indexOf(i)===c).map(i=>i+1).reduce((i,c)=>Math.max(i,c))}function Hs(a,i){let c=0,d=["greater","lesser"];for(let M=0;M<d.length;++M){let E=i[d[M]];c+=Ve(E)*E.length/a.length}return Ve(a)-c}function tr(a){let i=a.length;if(i===0)return 0;let c=Se(a),d=0;for(let M=0;M<i;++M){let E=a[M];d+=(E-c)*(E-c)}return d}function er(a,i){let c=0,d=["greater","lesser"];for(let M=0;M<d.length;++M){let E=i[d[M]];c+=tr(E)}return c}function sr(a,i,c,d){let M=[],E=[],k=[],T=[];for(let v=0;v<a.rows;++v)a.get(v,c)<d?(M.push(a.getRow(v)),k.push(i[v])):(E.push(a.getRow(v)),T.push(i[v]));return{greaterX:E,greaterY:T,lesserX:M,lesserY:k}}function rr(a,i){return(a+i)/2}function nr(a,i){if(a.length!==i.length)throw new TypeError(`Error on zip: the size of a: ${a.length} is different from b: ${i.length}`);let c=new Array(a.length);for(let d=0;d<a.length;++d)c[d]=[a[d],i[d]];return c}const or={gini:Hs,regression:er},ir={mean:rr};class Rt{constructor(i){this.kind=i.kind,this.gainFunction=i.gainFunction,this.splitFunction=i.splitFunction,this.minNumSamples=i.minNumSamples,this.maxDepth=i.maxDepth,this.gainThreshold=i.gainThreshold||0}bestSplit(i,c){let d=this.kind==="classifier"?-1/0:1/0,M=this.kind==="classifier"?(v,O)=>v>O:(v,O)=>v<O,E,k,T;for(let v=0;v<i.rows;++v){let O=i.getRow(v),_=this.featureSplit(O,c);for(let U=0;U<_.length;++U){let tt=_[U],gt=this.split(O,c,tt),ct=or[this.gainFunction](c,gt);M(ct,d)&&(E=v,k=tt,d=ct,T=O.length)}}return{maxGain:d,maxColumn:E,maxValue:k,numberSamples:T}}split(i,c,d){let M=[],E=[];for(let k=0;k<i.length;++k)i[k]<d?M.push(c[k]):E.push(c[k]);return{greater:E,lesser:M}}featureSplit(i,c){let d=[],M=nr(i,c);M.sort((E,k)=>E[0]-k[0]);for(let E=1;E<M.length;++E)M[E-1][1]!==M[E][1]&&d.push(ir[this.splitFunction](M[E-1][0],M[E][0]));return d}calculatePrediction(i){if(this.kind==="classifier"){if(this.distribution=Xe(i,We(i)),this.distribution.columns===0)throw new TypeError("Error on calculate the prediction")}else this.distribution=Se(i)}train(i,c,d,M){if(i.rows<=this.minNumSamples){this.calculatePrediction(c);return}M===void 0&&(M=0);let E=i.transpose(),k=this.bestSplit(E,c);this.splitValue=k.maxValue,this.splitColumn=k.maxColumn,this.gain=k.maxGain,this.numberSamples=k.numberSamples;let T=sr(i,c,this.splitColumn,this.splitValue);if(d<this.maxDepth&&this.gain>this.gainThreshold&&this.gain!==M&&T.lesserX.length>0&&T.greaterX.length>0){this.left=new Rt(this),this.right=new Rt(this);let v=new lt(T.lesserX),O=new lt(T.greaterX);this.left.train(v,T.lesserY,d+1,this.gain),this.right.train(O,T.greaterY,d+1,this.gain)}else this.calculatePrediction(c)}classify(i){return this.right&&this.left?i[this.splitColumn]<this.splitValue?this.left.classify(i):this.right.classify(i):this.distribution}setNodeParameters(i){i.distribution!==void 0?this.distribution=i.distribution.constructor===Array?new lt(i.distribution):i.distribution:(this.distribution=void 0,this.splitValue=i.splitValue,this.splitColumn=i.splitColumn,this.gain=i.gain,this.left=new Rt(this),this.right=new Rt(this),i.left!=={}&&this.left.setNodeParameters(i.left),i.right!=={}&&this.right.setNodeParameters(i.right))}}const lr={gainFunction:"gini",splitFunction:"mean",minNumSamples:3,maxDepth:1/0,gainThreshold:.01};class ee{constructor(i,c){i===!0?(this.options=c.options,this.root=new Rt(c.options),this.root.setNodeParameters(c.root)):(this.options=Object.assign({},lr,i),this.options.kind="classifier")}train(i,c){this.root=new Rt(this.options),i=lt.checkMatrix(i),this.root.train(i,c,0,null)}predict(i){i=lt.checkMatrix(i);let c=new Array(i.rows);for(let d=0;d<i.rows;++d)c[d]=this.root.classify(i.getRow(d)).maxRowIndex(0)[1];return c}toJSON(){return{options:this.options,root:this.root,name:"DTClassifier"}}static load(i){if(i.name!=="DTClassifier")throw new RangeError(`Invalid model: ${i.name}`);return new ee(!0,i)}}const hr={gainFunction:"regression",splitFunction:"mean",minNumSamples:3,maxDepth:1/0};class se{constructor(i,c){i===!0?(this.options=c.options,this.root=new Rt(c.options),this.root.setNodeParameters(c.root)):(this.options=Object.assign({},hr,i),this.options.kind="regression")}train(i,c){this.root=new Rt(this.options),typeof i[0]<"u"&&i[0].length===void 0?i=lt.columnVector(i):i=lt.checkMatrix(i),this.root.train(i,c,0)}predict(i){typeof i[0]<"u"&&i[0].length===void 0&&(i=lt.columnVector(i)),i=lt.checkMatrix(i);let c=new Array(i.rows);for(let d=0;d<i.rows;++d)c[d]=this.root.classify(i.getRow(d));return c}toJSON(){return{options:this.options,root:this.root,name:"DTRegression"}}static load(i){if(i.name!=="DTRegression")throw new RangeError(`Invalid model:${i.name}`);return new se(!0,i)}}const kt=9007199254740992,te=kt-1,re=-1>>>0,dt=re+1,vt=dt/2,pe=vt-1,_t=1<<21,Ot=_t-1;function ur(a){return a.next()|0}function Ct(a,i){return i===0?a:c=>a(c)+i}function Le(a){const i=a.next()|0,c=a.next()>>>0;return(i&Ot)*dt+c+(i&_t?-9007199254740992:0)}function fr(a){for(;;){const i=a.next()|0;if(i&4194304){if((i&8388607)===4194304&&(a.next()|0)===0)return kt}else{const c=a.next()>>>0;return(i&Ot)*dt+c+(i&_t?-9007199254740992:0)}}}function ar(a){return a.next()>>>0}function cr(a){const i=a.next()&Ot,c=a.next()>>>0;return i*dt+c}function mr(a){for(;;){const i=a.next()|0;if(i&_t){if((i&Ot)===0&&(a.next()|0)===0)return kt}else{const c=a.next()>>>0;return(i&Ot)*dt+c}}}function Je(a){return(a+1&a)===0}function gr(a){return i=>i.next()&a}function wr(a){const i=a+1,c=i*Math.floor(dt/i);return d=>{let M=0;do M=d.next()>>>0;while(M>=c);return M%i}}function pr(a){return Je(a)?gr(a):wr(a)}function dr(a){return(a|0)===0}function yr(a){return i=>{const c=i.next()&a,d=i.next()>>>0;return c*dt+d}}function br(a){const i=a*Math.floor(kt/a);return c=>{let d=0;do{const M=c.next()&Ot,E=c.next()>>>0;d=M*dt+E}while(d>=i);return d%a}}function Mr(a){const i=a+1;if(dr(i)){const c=(i/dt|0)-1;if(Je(c))return yr(c)}return br(i)}function Be(a,i){return c=>{let d=0;do{const M=c.next()|0,E=c.next()>>>0;d=(M&Ot)*dt+E+(M&_t?-9007199254740992:0)}while(d<a||d>i);return d}}function xe(a,i){if(a=Math.floor(a),i=Math.floor(i),a<-9007199254740992||!isFinite(a))throw new RangeError(`Expected min to be at least ${-9007199254740992}`);if(i>kt||!isFinite(i))throw new RangeError(`Expected max to be at most ${kt}`);const c=i-a;return c<=0||!isFinite(c)?()=>a:c===re?a===0?ar:Ct(ur,a+vt):c<re?Ct(pr(c),a):c===te?Ct(cr,a):c<te?Ct(Mr(c),a):i-1-a===te?Ct(mr,a):a===-9007199254740992&&i===kt?fr:a===-9007199254740992&&i===te?Le:a===-9007199254740991&&i===kt?Ct(Le,1):i===kt?Ct(Be(a-1,i-1),1):Be(a,i)}const jr="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";function Ye(a=jr){const i=a.length;if(!i)throw new Error("Expected pool not to be an empty string");const c=xe(0,i-1);return(d,M)=>{let E="";for(let k=0;k<M;++k){const T=c(d);E+=a.charAt(T)}return E}}const Qe="0123456789abcdef";Ye(Qe);Ye(Qe.toUpperCase());(()=>{try{if("x".repeat(3)==="xxx")return(a,i)=>a.repeat(i)}catch{}return(a,i)=>{let c="";for(;i>0;)i&1&&(c+=a),i>>=1,a+=a;return c}})();const Er={next(){return Math.random()*dt|0}},Sr=(()=>{try{const a=new ArrayBuffer(4),i=new Int32Array(a);if(i[0]=vt,i[0]===-vt)return Int32Array}catch{}return Array})();function xr(a=Er,i=16){const c=[];c.push(new Date().getTime()|0);for(let d=1;d<i;++d)c[d]=a.next()|0;return c}const je=(()=>{try{if(Math.imul(re,5)===-5)return Math.imul}catch{}const a=65535;return(i,c)=>{const d=i>>>16&a,M=i&a,E=c>>>16&a,k=c&a;return M*k+(d*k+M*E<<16>>>0)|0}})(),Mt=624,Nt=Mt-1,Ee=397,Pe=Mt-Ee,de=2567483615;class It{constructor(){this.data=new Sr(Mt),this.index=0,this.uses=0}static seed(i){return new It().seed(i)}static seedWithArray(i){return new It().seedWithArray(i)}static autoSeed(){return It.seedWithArray(xr())}next(){(this.index|0)>=Mt&&(ye(this.data),this.index=0);const i=this.data[this.index];return this.index=this.index+1|0,this.uses+=1,kr(i)|0}getUseCount(){return this.uses}discard(i){if(i<=0)return this;for(this.uses+=i,(this.index|0)>=Mt&&(ye(this.data),this.index=0);i+this.index>Mt;)i-=Mt-this.index,ye(this.data),this.index=0;return this.index=this.index+i|0,this}seed(i){let c=0;this.data[0]=c=i|0;for(let d=1;d<Mt;d=d+1|0)this.data[d]=c=je(c^c>>>30,1812433253)+d|0;return this.index=Mt,this.uses=0,this}seedWithArray(i){return this.seed(19650218),Rr(this.data,i),this}}function ye(a){let i=0,c=0;for(;(i|0)<Pe;i=i+1|0)c=a[i]&vt|a[i+1|0]&pe,a[i]=a[i+Ee|0]^c>>>1^(c&1?de:0);for(;(i|0)<Nt;i=i+1|0)c=a[i]&vt|a[i+1|0]&pe,a[i]=a[i-Pe|0]^c>>>1^(c&1?de:0);c=a[Nt]&vt|a[0]&pe,a[Nt]=a[Ee-1]^c>>>1^(c&1?de:0)}function kr(a){return a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^a>>>18}function Rr(a,i){let c=1,d=0;const M=i.length;let E=Math.max(M,Mt)|0,k=a[0]|0;for(;(E|0)>0;--E)a[c]=k=(a[c]^je(k^k>>>30,1664525))+(i[d]|0)+(d|0)|0,c=c+1|0,++d,(c|0)>Nt&&(a[0]=a[Nt],c=1),d>=M&&(d=0);for(E=Nt;(E|0)>0;--E)a[c]=k=(a[c]^je(k^k>>>30,1566083941))-c|0,c=c+1|0,(c|0)>Nt&&(a[0]=a[Nt],c=1);a[0]=vt}function Nr(a){return a>0&&a<=1}function vr(a){return Number(a)===a&&a%1!==0}function Ir(a,i,c){let d,M=xe(0,a.rows-1);if(c===void 0)d=It.autoSeed();else if(Number.isInteger(c))d=It.seed(c);else throw new RangeError(`Expected seed must be undefined or integer not ${c}`);let E=new Array(a.rows),k=new Array(a.rows),T=new Array(a.rows).fill(0),v=a.rows;for(let U=0;U<a.rows;++U){let tt=M(d);E[U]=a.getRow(tt),k[U]=i[tt],T[tt]++===0&&v--}let O=new Array(v),_=new Array(v);for(let U=a.rows-1;U>=0&&v>0;--U)T[U]===0&&(O[--v]=a.getRow(U),_[v]=U);return{X:new lt(E),y:k,Xoob:new lt(O),ioob:_,seed:d.next()}}function Tr(a,i,c,d){if(a.columns<i)throw new RangeError("N should be less or equal to the number of columns of X");let M=xe(0,a.columns-1),E;if(d===void 0)E=It.autoSeed();else if(Number.isInteger(d))E=It.seed(d);else throw new RangeError(`Expected seed must be undefined or integer not ${d}`);let k=new lt(a.rows,i),T,v;if(c){T=new Array(i);for(let O=0;O<i;++O)v=M(E),T[O]=v,k.setColumn(O,a.getColumn(v))}else{T=new Set,v=M(E);for(let O=0;O<i;++O){for(;T.has(v);)v=M(E);k.setColumn(O,a.getColumn(v)),T.add(v)}T=Array.from(T)}return{X:k,usedIndex:T,seed:E.next()}}const Fr=(a,i,c)=>{const d=Array(i.length);for(let M=0;M<i.length;M++){const E=[];for(let k=0;k<a.length;k++){const T=a[k];T.index[0]===M&&(E.push(T.predicted[0]),T.index=T.index.slice(1),T.predicted=T.predicted.slice(1))}d[M]={true:i[M],all:E,predicted:c(E)}}return d};class Cr{constructor(i,c){if(i===!0){this.replacement=c.replacement,this.maxFeatures=c.maxFeatures,this.nEstimators=c.nEstimators,this.treeOptions=c.treeOptions,this.isClassifier=c.isClassifier,this.seed=c.seed,this.n=c.n,this.indexes=c.indexes,this.useSampleBagging=c.useSampleBagging,this.noOOB=!0,this.maxSamples=c.maxSamples;let d=this.isClassifier?ee:se;this.estimators=c.estimators.map(M=>d.load(M))}else this.replacement=i.replacement,this.maxFeatures=i.maxFeatures,this.nEstimators=i.nEstimators,this.treeOptions=i.treeOptions,this.isClassifier=i.isClassifier,this.seed=i.seed,this.useSampleBagging=i.useSampleBagging,this.noOOB=i.noOOB,this.maxSamples=i.maxSamples}train(i,c){let d=this.seed;if(i=lt.checkMatrix(i),this.maxFeatures=this.maxFeatures||i.columns,this.numberFeatures=i.columns,this.numberSamples=i.rows,Nr(this.maxFeatures))this.n=Math.floor(i.columns*this.maxFeatures);else if(Number.isInteger(this.maxFeatures)){if(this.maxFeatures>i.columns)throw new RangeError(`The maxFeatures parameter should be less than ${i.columns}`);this.n=this.maxFeatures}else throw new RangeError(`Cannot process the maxFeatures parameter ${this.maxFeatures}`);if(this.maxSamples){if(this.maxSamples<0)throw new RangeError("Please choose a positive value for maxSamples");if(vr(this.maxSamples)){if(this.maxSamples>1)throw new RangeError("Please choose either a float value between 0 and 1 or a positive integer for maxSamples");this.numberSamples=Math.floor(i.rows*this.maxSamples)}else if(Number.isInteger(this.maxSamples)){if(this.maxSamples>i.rows)throw new RangeError(`The maxSamples parameter should be less than ${i.rows}`);this.numberSamples=this.maxSamples}}if(this.maxSamples&&i.rows!==this.numberSamples){let k=new lt(this.numberSamples,i.columns);for(let T=0;T<this.numberSamples;T++)k.removeRow(0);for(let T=0;T<this.numberSamples;T++)k.addRow(i.getRow(T));i=k,c=c.slice(0,this.numberSamples)}let M;this.isClassifier?M=ee:M=se,this.estimators=new Array(this.nEstimators),this.indexes=new Array(this.nEstimators);let E=new Array(this.nEstimators);for(let k=0;k<this.nEstimators;++k){let T=this.useSampleBagging?Ir(i,c,d):{X:i,y:c,seed:d,Xoob:void 0,ioob:[]},v=T.X,O=T.y;d=T.seed;let{Xoob:_,ioob:U}=T;if(T=Tr(v,this.n,this.replacement,d),v=T.X,d=T.seed,this.indexes[k]=T.usedIndex,this.estimators[k]=new M(this.treeOptions),this.estimators[k].train(v,O),!this.noOOB&&this.useSampleBagging){let tt=new $e(_,this.indexes[k]);E[k]={index:U,predicted:this.estimators[k].predict(tt)}}}!this.noOOB&&this.useSampleBagging&&E.length>0&&(this.oobResults=Fr(E,c,this.selection.bind(this)))}featureImportance(){const i=JSON.parse(JSON.stringify(this.estimators)),c=JSON.parse(JSON.stringify(this.indexes));let d=[];function M(v,O){if(!O||!("splitColumn"in O)||!(O.gain>0))return;let _=O.gain*O.numberSamples;"left"in O&&(_-=(O.left.gain||0)*(O.left.numberSamples||0)),"right"in O&&(_-=(O.right.gain||0)*(O.right.numberSamples||0)),d[v][O.splitColumn]+=_,O.left&&M(v,O.left),O.right&&M(v,O.right)}function E(v){const O=d[v].reduce((_,U)=>_+=U,0);d[v]=d[v].map(_=>_/O)}for(let v=0;v<i.length;v++)d.push(new Array(this.numberFeatures).fill(0)),M(v,i[v].root),E(v);let k=new Array(this.numberFeatures).fill(0);for(let v=0;v<d.length;v++)for(let O=0;O<this.numberFeatures;O++)k[c[v][O]]+=d[v][O];const T=k.reduce((v,O)=>v+=O,0);return k.map(v=>v/T)}selection(i){throw new Error("Abstract method 'selection' not implemented!")}predict(i){const c=this.predictionValues(i);let d=new Array(c.rows);for(let M=0;M<c.rows;++M)d[M]=this.selection(c.getRow(M));return d}predictionValues(i){let c=new Array(this.nEstimators);i=lt.checkMatrix(i);for(let d=0;d<this.nEstimators;++d){let M=new $e(i,this.indexes[d]);c[d]=this.estimators[d].predict(M)}return c=new Ks(new Zs(c))}predictOOB(){if(!this.oobResults||this.oobResults.length===0)throw new Error("No Out-Of-Bag results found. Did you forgot to train first?");return this.oobResults.map(i=>i.predicted)}toJSON(){return{indexes:this.indexes,n:this.n,replacement:this.replacement,maxFeatures:this.maxFeatures,nEstimators:this.nEstimators,treeOptions:this.treeOptions,isClassifier:this.isClassifier,seed:this.seed,estimators:this.estimators.map(i=>i.toJSON()),useSampleBagging:this.useSampleBagging}}}var be={exports:{}},ze;function qr(){return ze||(ze=1,function(a){(function(){function i(M){for(var E=0,k=M.length-1,T=void 0,v=void 0,O=void 0,_=d(E,k);;){if(k<=E)return M[_];if(k==E+1)return M[E]>M[k]&&c(M,E,k),M[_];for(T=d(E,k),M[T]>M[k]&&c(M,T,k),M[E]>M[k]&&c(M,E,k),M[T]>M[E]&&c(M,T,E),c(M,T,E+1),v=E+1,O=k;;){do v++;while(M[E]>M[v]);do O--;while(M[O]>M[E]);if(O<v)break;c(M,v,O)}c(M,E,O),O<=_&&(E=v),O>=_&&(k=O-1)}}var c=function(E,k,T){var v;return v=[E[T],E[k]],E[k]=v[0],E[T]=v[1],v},d=function(E,k){return~~((E+k)/2)};a.exports?a.exports=i:window.median=i})()}(be)),be.exports}var Or=qr();const Dr=_e(Or);function $r(a){if(!qt(a))throw new TypeError("input must be an array");if(a.length===0)throw new TypeError("input must not be empty");return Dr(a.slice())}const Vr={mean:Se,median:$r},Lr={maxFeatures:1,replacement:!1,nEstimators:50,treeOptions:{},selectionMethod:"mean",seed:42,useSampleBagging:!0,noOOB:!1};class ke extends Cr{constructor(i,c){if(i===!0)super(!0,c.baseModel),this.selectionMethod=c.selectionMethod;else{if(i=Object.assign({},Lr,i),!(i.selectionMethod==="mean"||i.selectionMethod==="median"))throw new RangeError(`Unsupported selection method ${i.selectionMethod}`);i.isClassifier=!1,super(i),this.selectionMethod=i.selectionMethod}}selection(i){return Vr[this.selectionMethod](i)}toJSON(){return{baseModel:super.toJSON(),selectionMethod:this.selectionMethod,name:"RFRegression"}}static load(i){if(i.name!=="RFRegression")throw new RangeError(`Invalid model: ${i.name}`);return new ke(!0,i)}}async function Jr(a,i,c){try{const d={indikator:c,name:i,model_json:a.toJSON()},M=await Ut.post(route("randomForest.store"),d,{headers:{"Content-Type":"application/json"}});return console.log(M),{success:!0,message:"Model saved successfully"}}catch(d){return console.error("Error saving model:",d),{success:!1,message:d instanceof Error?d.message:"Unknown error occurred"}}}async function Yr(a){var i;try{const c=await Ut.get(route("randomForest.getModel",{modelName:a}));if(c.data.error)throw new Error(c.data.message||`Model ${a} tidak ditemukan`);if(!c.data.indikator||!c.data.model_json)throw new Error("Data model tidak lengkap dari server");const{indikator:d,model_json:M}=c.data,E=ke.load(M);return{indikator:d,model:E}}catch(c){throw console.error("Error loading model:",c),Ut.isAxiosError(c)&&((i=c.response)==null?void 0:i.status)===404?new Error(`Model "${a}" tidak ditemukan di server`):new Error(c instanceof Error?c.message:"Failed to load model")}}function Qr({models:a,indikator:i,className:c,opsiGejala:d,jenisTanaman:M}){const{auth:E}=Os().props,[k,T]=At.useState({text:"",status:!1}),[v,O]=At.useState(!1),_=async J=>{try{const P=await Ut.get(route("randomForest.getLabel",{label:Number(J).toFixed(0)}));if(P.status==200)return P.data}catch(P){return console.log(P),""}},{data:U,setData:tt,errors:gt}=Ds({jenis_tanaman:"",label:"",attribut:i.map(()=>"")}),[ct,Bt]=At.useState({jenisTanaman:null,prediksi:null}),[Pt,Dt]=At.useState({ph:{mse:null,r2:null},ppm:{mse:null,r2:null},ketinggianAir:{mse:null,r2:null},label:{mse:null,r2:null}}),$t=J=>{const{name:P,value:K}=J.target,ht=P.split(".")[1];if(/^\d*\.?\d*$/.test(K)){const jt=Number(K);isNaN(jt)||tt(et=>({...et,attribut:et.attribut.map((mt,Tt)=>Tt===Number(ht)?K:mt)}))}},yt=(J,P)=>{J&&P!==void 0&&U&&U.attribut?tt(J==="label"||J==="jenis_tanaman"?K=>({...K,[J]:P}):K=>({...K,attribut:K.attribut.map((ht,jt)=>jt===Number(J)?P:ht)})):console.error("Invalid data: name, value, or attribut may be undefined")},ne=(J,P)=>{const K=[P];return J.predict(K)[0]},oe=async J=>{if(J.preventDefault(),!a)return;const P={ph:null,ppm:null,ketinggianAir:null,label:null},K={...Pt},ht=U.attribut.map(et=>{const mt=d.find(Tt=>Tt.nama===et);return mt?mt.id:Number(et)}),jt=M.find(et=>et.nama===U.jenis_tanaman);ht.push((jt==null?void 0:jt.id)||0);try{if(Object.keys(a).forEach(et=>{const mt=a[et];if(!mt)return;const Tt=ne(mt,ht);P[et]=Tt}),console.log(P),P.label){const et=await _(P.label),mt=`Keterangan : Nutrisi ${et.nama}. <br/> Saran: ${et.deskripsi}`;Bt({jenisTanaman:mt,prediksi:{ph:P.ph,ppm:P.ppm,ketinggianAir:P.ketinggianAir,label:et.nama}}),E.user&&E.role=="user"&&ie({jenisTanaman:mt,prediksi:{ph:P.ph,ppm:P.ppm,ketinggianAir:P.ketinggianAir,label:et.nama}})}Dt(K)}catch(et){console.log(et),T({text:"Gagal Melakukan prediksi, ini mungkin kesalahan akibat train model yang salah. mohon ulangi sekali lagi",status:!0}),O(!0)}},ie=async J=>{try{await Ut.post(route("riwayat-klasifikasi.store"),{user_id:E.user.id,user:E.user,jenis_tanaman:J.jenisTanaman,label:JSON.stringify(J.prediksi),attribut:U.attribut,kriteria:i.map(P=>P)})}catch(P){console.log("gagal menyimpan riwayat",P)}};return V.jsxs("div",{className:"rounded-lg border bg-white p-6 shadow",children:[V.jsx(Ps,{open:v,onOpenChange:O,title:"Terjadi Kesalahan Prediksi",description:k.text}),V.jsx("h3",{className:"mb-4 text-lg font-semibold",children:"Nutrisi Tanaman"}),V.jsxs("div",{className:$s("grid grid-cols-1 gap-4",c),children:[V.jsxs("form",{onSubmit:oe,className:"col-span-1",children:[V.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[V.jsxs("div",{children:[V.jsx(Ht,{className:"text-xs text-gray-600",children:"Jenis Tanaman"}),V.jsxs(ae,{value:U.jenis_tanaman,required:!0,onValueChange:J=>yt("jenis_tanaman",J),children:[V.jsx(ce,{className:"input-minimal",children:V.jsx(me,{placeholder:"Pilih"})}),V.jsx(ge,{children:M.map((J,P)=>V.jsx(we,{value:J.nama,children:J.nama},P))})]}),gt.jenis_tanaman&&V.jsx(Ls,{message:gt.jenis_tanaman,className:"mt-2"})]}),i.map((J,P)=>J==="gejala"?V.jsxs("div",{children:[V.jsx(Ht,{htmlFor:`attribut.${P}`,className:"text-xs text-gray-600",children:J}),V.jsxs(ae,{value:U.attribut[P]||"",required:!0,onValueChange:K=>yt(P.toLocaleString(),K),children:[V.jsx(ce,{className:"input-minimal",children:V.jsx(me,{placeholder:"Pilih"})}),V.jsx(ge,{children:d.map((K,ht)=>V.jsx(we,{value:K.nama,children:K.nama},ht))})]})]},P):J.toLowerCase().includes("ph")?V.jsxs("div",{children:[V.jsx(Ht,{htmlFor:`attribut.${P}`,className:"text-xs text-gray-600",children:J}),V.jsxs(ae,{value:U.attribut[P]||"",required:!0,onValueChange:K=>yt(P.toLocaleString(),K),children:[V.jsx(ce,{className:"input-minimal",children:V.jsx(me,{placeholder:"Pilih"})}),V.jsx(ge,{children:["0","1","2","3","4","5","6","7","8"].map((K,ht)=>V.jsx(we,{value:K,children:K},ht))})]}),V.jsx("p",{className:"text-xs text-gray-400",children:"ph 1...5 itu kurang 6..7 itu sehat dan 8 itu brlebihan"})]},P):V.jsxs("div",{children:[V.jsx(Ht,{className:"text-xs text-gray-600",children:J}),V.jsx(Bs,{type:"text",name:`attribut.${P}`,value:U.attribut[P]||"",onChange:$t,className:"input-minimal",placeholder:`masukkan ${J}`,required:!0})]},P))]}),V.jsx(Vs,{type:"submit",variant:"default",className:"mt-4 w-full",children:"Prediksi Semua"})]}),V.jsx("div",{className:"col-span-1",children:(ct.jenisTanaman!==null||ct.prediksi!==null)&&V.jsx("div",{className:"mt-6 space-y-4",children:V.jsx("div",{className:"grid grid-cols-1 gap-4",children:ct.jenisTanaman&&V.jsx(Br,{title:ct.jenisTanaman,value:ct.prediksi})})})})]})]})}const Br=({title:a,value:i})=>{var c,d,M;return V.jsxs("div",{className:"rounded-lg bg-green-50 p-4",children:[V.jsx("h4",{className:"font-medium text-green-800",dangerouslySetInnerHTML:{__html:a}}),V.jsx("table",{children:V.jsxs("tbody",{children:[V.jsxs("tr",{children:[V.jsx("th",{className:"border p-2 text-xs",children:"PH"}),V.jsx("th",{className:"border p-2 text-xs",children:"PPM"}),V.jsx("th",{className:"border p-2 text-xs",children:"Ketinggian Air"}),V.jsx("th",{className:"border p-2 text-xs",children:"Label"})]}),V.jsxs("tr",{children:[V.jsx("td",{className:"border p-2 text-center",children:(c=i==null?void 0:i.ph)==null?void 0:c.toFixed(2)}),V.jsx("td",{className:"border p-2 text-center",children:(d=i==null?void 0:i.ppm)==null?void 0:d.toFixed(2)}),V.jsx("td",{className:"border p-2 text-center",children:(M=i==null?void 0:i.ketinggianAir)==null?void 0:M.toFixed(2)}),V.jsx("td",{className:"border p-2 text-center",children:i==null?void 0:i.label})]})]})})]})};export{Qr as F,ke as R,Yr as l,Jr as s};
